"use strict";var Ec=Object.create;var St=Object.defineProperty;var Sc=Object.getOwnPropertyDescriptor;var _c=Object.getOwnPropertyNames;var bc=Object.getPrototypeOf,yc=Object.prototype.hasOwnProperty;var f=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),Tc=(r,e)=>{for(var t in e)St(r,t,{get:e[t],enumerable:!0})},zs=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of _c(e))!yc.call(r,n)&&n!==t&&St(r,n,{get:()=>e[n],enumerable:!(s=Sc(e,n))||s.enumerable});return r};var ge=(r,e,t)=>(t=r!=null?Ec(bc(r)):{},zs(e||!r||!r.__esModule?St(t,"default",{value:r,enumerable:!0}):t,r)),Ac=r=>zs(St({},"__esModule",{value:!0}),r);var Ur=f((je,ye)=>{var Cc=200,mn="__lodash_hash_undefined__",Ic=800,Lc=16,vn=9007199254740991,En="[object Arguments]",Nc="[object Array]",Oc="[object AsyncFunction]",qc="[object Boolean]",xc="[object Date]",Mc="[object Error]",Sn="[object Function]",Dc="[object GeneratorFunction]",$c="[object Map]",kc="[object Number]",Pc="[object Null]",_n="[object Object]",Fc="[object Proxy]",Bc="[object RegExp]",Uc="[object Set]",jc="[object String]",Wc="[object Undefined]",Gc="[object WeakMap]",Vc="[object ArrayBuffer]",Xc="[object DataView]",Kc="[object Float32Array]",Hc="[object Float64Array]",zc="[object Int8Array]",Yc="[object Int16Array]",Qc="[object Int32Array]",Jc="[object Uint8Array]",Zc="[object Uint8ClampedArray]",el="[object Uint16Array]",tl="[object Uint32Array]",rl=/[\\^$.*+?()[\]{}|]/g,sl=/^\[object .+?Constructor\]$/,nl=/^(?:0|[1-9]\d*)$/,A={};A[Kc]=A[Hc]=A[zc]=A[Yc]=A[Qc]=A[Jc]=A[Zc]=A[el]=A[tl]=!0;A[En]=A[Nc]=A[Vc]=A[qc]=A[Xc]=A[xc]=A[Mc]=A[Sn]=A[$c]=A[kc]=A[_n]=A[Bc]=A[Uc]=A[jc]=A[Gc]=!1;var bn=typeof global=="object"&&global&&global.Object===Object&&global,il=typeof self=="object"&&self&&self.Object===Object&&self,Ve=bn||il||Function("return this")(),yn=typeof je=="object"&&je&&!je.nodeType&&je,We=yn&&typeof ye=="object"&&ye&&!ye.nodeType&&ye,Tn=We&&We.exports===yn,Or=Tn&&bn.process,an=function(){try{var r=We&&We.require&&We.require("util").types;return r||Or&&Or.binding&&Or.binding("util")}catch{}}(),un=an&&an.isTypedArray;function ol(r,e,t){switch(t.length){case 0:return r.call(e);case 1:return r.call(e,t[0]);case 2:return r.call(e,t[0],t[1]);case 3:return r.call(e,t[0],t[1],t[2])}return r.apply(e,t)}function al(r,e){for(var t=-1,s=Array(r);++t<r;)s[t]=e(t);return s}function ul(r){return function(e){return r(e)}}function cl(r,e){return r?.[e]}function ll(r,e){return function(t){return r(e(t))}}var dl=Array.prototype,fl=Function.prototype,At=Object.prototype,qr=Ve["__core-js_shared__"],Rt=fl.toString,ee=At.hasOwnProperty,cn=function(){var r=/[^.]+$/.exec(qr&&qr.keys&&qr.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}(),An=At.toString,hl=Rt.call(Object),pl=RegExp("^"+Rt.call(ee).replace(rl,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),yt=Tn?Ve.Buffer:void 0,ln=Ve.Symbol,dn=Ve.Uint8Array,fn=yt?yt.allocUnsafe:void 0,Rn=ll(Object.getPrototypeOf,Object),hn=Object.create,gl=At.propertyIsEnumerable,ml=dl.splice,ve=ln?ln.toStringTag:void 0,Tt=function(){try{var r=Pr(Object,"defineProperty");return r({},"",{}),r}catch{}}(),vl=yt?yt.isBuffer:void 0,pn=Math.max,El=Date.now,wn=Pr(Ve,"Map"),Ge=Pr(Object,"create"),Sl=function(){function r(){}return function(e){if(!Se(e))return{};if(hn)return hn(e);r.prototype=e;var t=new r;return r.prototype=void 0,t}}();function Ee(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var s=r[e];this.set(s[0],s[1])}}function _l(){this.__data__=Ge?Ge(null):{},this.size=0}function bl(r){var e=this.has(r)&&delete this.__data__[r];return this.size-=e?1:0,e}function yl(r){var e=this.__data__;if(Ge){var t=e[r];return t===mn?void 0:t}return ee.call(e,r)?e[r]:void 0}function Tl(r){var e=this.__data__;return Ge?e[r]!==void 0:ee.call(e,r)}function Al(r,e){var t=this.__data__;return this.size+=this.has(r)?0:1,t[r]=Ge&&e===void 0?mn:e,this}Ee.prototype.clear=_l;Ee.prototype.delete=bl;Ee.prototype.get=yl;Ee.prototype.has=Tl;Ee.prototype.set=Al;function te(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var s=r[e];this.set(s[0],s[1])}}function Rl(){this.__data__=[],this.size=0}function wl(r){var e=this.__data__,t=wt(e,r);if(t<0)return!1;var s=e.length-1;return t==s?e.pop():ml.call(e,t,1),--this.size,!0}function Cl(r){var e=this.__data__,t=wt(e,r);return t<0?void 0:e[t][1]}function Il(r){return wt(this.__data__,r)>-1}function Ll(r,e){var t=this.__data__,s=wt(t,r);return s<0?(++this.size,t.push([r,e])):t[s][1]=e,this}te.prototype.clear=Rl;te.prototype.delete=wl;te.prototype.get=Cl;te.prototype.has=Il;te.prototype.set=Ll;function Te(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var s=r[e];this.set(s[0],s[1])}}function Nl(){this.size=0,this.__data__={hash:new Ee,map:new(wn||te),string:new Ee}}function Ol(r){var e=It(this,r).delete(r);return this.size-=e?1:0,e}function ql(r){return It(this,r).get(r)}function xl(r){return It(this,r).has(r)}function Ml(r,e){var t=It(this,r),s=t.size;return t.set(r,e),this.size+=t.size==s?0:1,this}Te.prototype.clear=Nl;Te.prototype.delete=Ol;Te.prototype.get=ql;Te.prototype.has=xl;Te.prototype.set=Ml;function Ae(r){var e=this.__data__=new te(r);this.size=e.size}function Dl(){this.__data__=new te,this.size=0}function $l(r){var e=this.__data__,t=e.delete(r);return this.size=e.size,t}function kl(r){return this.__data__.get(r)}function Pl(r){return this.__data__.has(r)}function Fl(r,e){var t=this.__data__;if(t instanceof te){var s=t.__data__;if(!wn||s.length<Cc-1)return s.push([r,e]),this.size=++t.size,this;t=this.__data__=new Te(s)}return t.set(r,e),this.size=t.size,this}Ae.prototype.clear=Dl;Ae.prototype.delete=$l;Ae.prototype.get=kl;Ae.prototype.has=Pl;Ae.prototype.set=Fl;function Bl(r,e){var t=$r(r),s=!t&&Dr(r),n=!t&&!s&&Nn(r),i=!t&&!s&&!n&&qn(r),o=t||s||n||i,a=o?al(r.length,String):[],u=a.length;for(var c in r)(e||ee.call(r,c))&&!(o&&(c=="length"||n&&(c=="offset"||c=="parent")||i&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||In(c,u)))&&a.push(c);return a}function xr(r,e,t){(t!==void 0&&!Lt(r[e],t)||t===void 0&&!(e in r))&&kr(r,e,t)}function Ul(r,e,t){var s=r[e];(!(ee.call(r,e)&&Lt(s,t))||t===void 0&&!(e in r))&&kr(r,e,t)}function wt(r,e){for(var t=r.length;t--;)if(Lt(r[t][0],e))return t;return-1}function kr(r,e,t){e=="__proto__"&&Tt?Tt(r,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):r[e]=t}var jl=td();function Ct(r){return r==null?r===void 0?Wc:Pc:ve&&ve in Object(r)?rd(r):ud(r)}function gn(r){return Xe(r)&&Ct(r)==En}function Wl(r){if(!Se(r)||od(r))return!1;var e=Br(r)?pl:sl;return e.test(fd(r))}function Gl(r){return Xe(r)&&On(r.length)&&!!A[Ct(r)]}function Vl(r){if(!Se(r))return ad(r);var e=Ln(r),t=[];for(var s in r)s=="constructor"&&(e||!ee.call(r,s))||t.push(s);return t}function Cn(r,e,t,s,n){r!==e&&jl(e,function(i,o){if(n||(n=new Ae),Se(i))Xl(r,e,o,t,Cn,s,n);else{var a=s?s(Mr(r,o),i,o+"",r,e,n):void 0;a===void 0&&(a=i),xr(r,o,a)}},xn)}function Xl(r,e,t,s,n,i,o){var a=Mr(r,t),u=Mr(e,t),c=o.get(u);if(c){xr(r,t,c);return}var l=i?i(a,u,t+"",r,e,o):void 0,d=l===void 0;if(d){var m=$r(u),h=!m&&Nn(u),b=!m&&!h&&qn(u);l=u,m||h||b?$r(a)?l=a:hd(a)?l=Jl(a):h?(d=!1,l=zl(u,!0)):b?(d=!1,l=Ql(u,!0)):l=[]:pd(u)||Dr(u)?(l=a,Dr(a)?l=gd(a):(!Se(a)||Br(a))&&(l=sd(u))):d=!1}d&&(o.set(u,l),n(l,u,s,i,o),o.delete(u)),xr(r,t,l)}function Kl(r,e){return ld(cd(r,e,Mn),r+"")}var Hl=Tt?function(r,e){return Tt(r,"toString",{configurable:!0,enumerable:!1,value:vd(e),writable:!0})}:Mn;function zl(r,e){if(e)return r.slice();var t=r.length,s=fn?fn(t):new r.constructor(t);return r.copy(s),s}function Yl(r){var e=new r.constructor(r.byteLength);return new dn(e).set(new dn(r)),e}function Ql(r,e){var t=e?Yl(r.buffer):r.buffer;return new r.constructor(t,r.byteOffset,r.length)}function Jl(r,e){var t=-1,s=r.length;for(e||(e=Array(s));++t<s;)e[t]=r[t];return e}function Zl(r,e,t,s){var n=!t;t||(t={});for(var i=-1,o=e.length;++i<o;){var a=e[i],u=s?s(t[a],r[a],a,t,r):void 0;u===void 0&&(u=r[a]),n?kr(t,a,u):Ul(t,a,u)}return t}function ed(r){return Kl(function(e,t){var s=-1,n=t.length,i=n>1?t[n-1]:void 0,o=n>2?t[2]:void 0;for(i=r.length>3&&typeof i=="function"?(n--,i):void 0,o&&nd(t[0],t[1],o)&&(i=n<3?void 0:i,n=1),e=Object(e);++s<n;){var a=t[s];a&&r(e,a,s,i)}return e})}function td(r){return function(e,t,s){for(var n=-1,i=Object(e),o=s(e),a=o.length;a--;){var u=o[r?a:++n];if(t(i[u],u,i)===!1)break}return e}}function It(r,e){var t=r.__data__;return id(e)?t[typeof e=="string"?"string":"hash"]:t.map}function Pr(r,e){var t=cl(r,e);return Wl(t)?t:void 0}function rd(r){var e=ee.call(r,ve),t=r[ve];try{r[ve]=void 0;var s=!0}catch{}var n=An.call(r);return s&&(e?r[ve]=t:delete r[ve]),n}function sd(r){return typeof r.constructor=="function"&&!Ln(r)?Sl(Rn(r)):{}}function In(r,e){var t=typeof r;return e=e??vn,!!e&&(t=="number"||t!="symbol"&&nl.test(r))&&r>-1&&r%1==0&&r<e}function nd(r,e,t){if(!Se(t))return!1;var s=typeof e;return(s=="number"?Fr(t)&&In(e,t.length):s=="string"&&e in t)?Lt(t[e],r):!1}function id(r){var e=typeof r;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?r!=="__proto__":r===null}function od(r){return!!cn&&cn in r}function Ln(r){var e=r&&r.constructor,t=typeof e=="function"&&e.prototype||At;return r===t}function ad(r){var e=[];if(r!=null)for(var t in Object(r))e.push(t);return e}function ud(r){return An.call(r)}function cd(r,e,t){return e=pn(e===void 0?r.length-1:e,0),function(){for(var s=arguments,n=-1,i=pn(s.length-e,0),o=Array(i);++n<i;)o[n]=s[e+n];n=-1;for(var a=Array(e+1);++n<e;)a[n]=s[n];return a[e]=t(o),ol(r,this,a)}}function Mr(r,e){if(!(e==="constructor"&&typeof r[e]=="function")&&e!="__proto__")return r[e]}var ld=dd(Hl);function dd(r){var e=0,t=0;return function(){var s=El(),n=Lc-(s-t);if(t=s,n>0){if(++e>=Ic)return arguments[0]}else e=0;return r.apply(void 0,arguments)}}function fd(r){if(r!=null){try{return Rt.call(r)}catch{}try{return r+""}catch{}}return""}function Lt(r,e){return r===e||r!==r&&e!==e}var Dr=gn(function(){return arguments}())?gn:function(r){return Xe(r)&&ee.call(r,"callee")&&!gl.call(r,"callee")},$r=Array.isArray;function Fr(r){return r!=null&&On(r.length)&&!Br(r)}function hd(r){return Xe(r)&&Fr(r)}var Nn=vl||Ed;function Br(r){if(!Se(r))return!1;var e=Ct(r);return e==Sn||e==Dc||e==Oc||e==Fc}function On(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=vn}function Se(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}function Xe(r){return r!=null&&typeof r=="object"}function pd(r){if(!Xe(r)||Ct(r)!=_n)return!1;var e=Rn(r);if(e===null)return!0;var t=ee.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&Rt.call(t)==hl}var qn=un?ul(un):Gl;function gd(r){return Zl(r,xn(r))}function xn(r){return Fr(r)?Bl(r,!0):Vl(r)}var md=ed(function(r,e,t){Cn(r,e,t)});function vd(r){return function(){return r}}function Mn(r){return r}function Ed(){return!1}ye.exports=md});var Zn=f((LE,Jn)=>{"use strict";function Xr(r){return typeof r=="function"}var B=console.error.bind(console);function Qe(r,e,t){var s=!!r[e]&&r.propertyIsEnumerable(e);Object.defineProperty(r,e,{configurable:!0,enumerable:s,writable:!0,value:t})}function Je(r){r&&r.logger&&(Xr(r.logger)?B=r.logger:B("new logger isn't a function, not replacing"))}function Yn(r,e,t){if(!r||!r[e]){B("no original function "+e+" to wrap");return}if(!t){B("no wrapper function"),B(new Error().stack);return}if(!Xr(r[e])||!Xr(t)){B("original object and wrapper must be functions");return}var s=r[e],n=t(s,e);return Qe(n,"__original",s),Qe(n,"__unwrap",function(){r[e]===n&&Qe(r,e,s)}),Qe(n,"__wrapped",!0),Qe(r,e,n),n}function wd(r,e,t){if(r)Array.isArray(r)||(r=[r]);else{B("must provide one or more modules to patch"),B(new Error().stack);return}if(!(e&&Array.isArray(e))){B("must provide one or more functions to wrap on modules");return}r.forEach(function(s){e.forEach(function(n){Yn(s,n,t)})})}function Qn(r,e){if(!r||!r[e]){B("no function to unwrap."),B(new Error().stack);return}if(!r[e].__unwrap)B("no original to unwrap to -- has "+e+" already been unwrapped?");else return r[e].__unwrap()}function Cd(r,e){if(r)Array.isArray(r)||(r=[r]);else{B("must provide one or more modules to patch"),B(new Error().stack);return}if(!(e&&Array.isArray(e))){B("must provide one or more functions to unwrap on modules");return}r.forEach(function(t){e.forEach(function(s){Qn(t,s)})})}Je.wrap=Yn;Je.massWrap=wd;Je.unwrap=Qn;Je.massUnwrap=Cd;Jn.exports=Je});var ni=f((NE,si)=>{"use strict";var ti=Zn(),Le=ti.wrap,Bt=ti.unwrap,se="wrap@before";function Ut(r,e,t){var s=!!r[e]&&r.propertyIsEnumerable(e);Object.defineProperty(r,e,{configurable:!0,enumerable:s,writable:!0,value:t})}function Id(r,e){for(var t=e.length,s=0;s<t;s++){var n=e[s],i=r[se];if(typeof i=="function")i(n);else if(Array.isArray(i))for(var o=i.length,a=0;a<o;a++)i[a](n)}}function ri(r,e){var t;return t=r._events&&r._events[e],Array.isArray(t)||(t?t=[t]:t=[]),t}function Ld(r,e,t){var s=ri(r,e),n=s.filter(function(i){return t.indexOf(i)===-1});n.length>0&&Id(r,n)}function ei(r,e){if(r){var t=r;if(typeof r=="function")t=e(r);else if(Array.isArray(r)){t=[];for(var s=0;s<r.length;s++)t[s]=e(r[s])}return t}}si.exports=function(e,t,s){if(!e||!e.on||!e.addListener||!e.removeListener||!e.emit)throw new Error("can only wrap real EEs");if(!t)throw new Error("must have function to run on listener addition");if(!s)throw new Error("must have function to wrap listeners when emitting");function n(o){return function(u,c){var l=ri(this,u).slice();try{var d=o.call(this,u,c);return Ld(this,u,l),d}finally{this.on.__wrapped||Le(this,"on",n),this.addListener.__wrapped||Le(this,"addListener",n)}}}function i(o){return function(u){if(!this._events||!this._events[u])return o.apply(this,arguments);var c=this._events[u];function l(d){return function(){this._events[u]=c;try{return d.apply(this,arguments)}finally{c=this._events[u],this._events[u]=ei(c,s)}}}Le(this,"removeListener",l);try{return this._events[u]=ei(c,s),o.apply(this,arguments)}finally{Bt(this,"removeListener"),this._events[u]=c}}}e[se]?typeof e[se]=="function"?Ut(e,se,[e[se],t]):Array.isArray(e[se])&&e[se].push(t):Ut(e,se,t),e.__wrapped||(Le(e,"addListener",n),Le(e,"on",n),Le(e,"emit",i),Ut(e,"__unwrap",function(){Bt(e,"addListener"),Bt(e,"on"),Bt(e,"emit"),delete e[se],delete e.__wrapped}),Ut(e,"__wrapped",!0))}});var ui=f((OE,ai)=>{"use strict";var S=require("util"),ne=require("assert"),Nd=ni(),R=require("async_hooks"),Ze="cls@contexts",et="error@context",O=process.env.DEBUG_CLS_HOOKED,E=-1;ai.exports={getNamespace:ii,createNamespace:Od,destroyNamespace:oi,reset:qd,ERROR_SYMBOL:et};function W(r){this.name=r,this.active=null,this._set=[],this.id=null,this._contexts=new Map,this._indent=0}W.prototype.set=function(e,t){if(!this.active)throw new Error("No context available. ns.run() or ns.bind() must be called first.");if(this.active[e]=t,O){let s=" ".repeat(this._indent<0?0:this._indent);L(s+"CONTEXT-SET KEY:"+e+"="+t+" in ns:"+this.name+" currentUid:"+E+" active:"+S.inspect(this.active,{showHidden:!0,depth:2,colors:!0}))}return t};W.prototype.get=function(e){if(!this.active){if(O){let t=R.currentId(),s=R.triggerAsyncId(),n=" ".repeat(this._indent<0?0:this._indent);L(`${n}CONTEXT-GETTING KEY NO ACTIVE NS: (${this.name}) ${e}=undefined currentUid:${E} asyncHooksCurrentId:${t} triggerId:${s} len:${this._set.length}`)}return}if(O){let t=R.executionAsyncId(),s=R.triggerAsyncId(),n=" ".repeat(this._indent<0?0:this._indent);L(n+"CONTEXT-GETTING KEY:"+e+"="+this.active[e]+" ("+this.name+") currentUid:"+E+" active:"+S.inspect(this.active,{showHidden:!0,depth:2,colors:!0})),L(`${n}CONTEXT-GETTING KEY: (${this.name}) ${e}=${this.active[e]} currentUid:${E} asyncHooksCurrentId:${t} triggerId:${s} len:${this._set.length} active:${S.inspect(this.active)}`)}return this.active[e]};W.prototype.createContext=function(){let e=Object.create(this.active?this.active:Object.prototype);if(e._ns_name=this.name,e.id=E,O){let t=R.executionAsyncId(),s=R.triggerAsyncId(),n=" ".repeat(this._indent<0?0:this._indent);L(`${n}CONTEXT-CREATED Context: (${this.name}) currentUid:${E} asyncHooksCurrentId:${t} triggerId:${s} len:${this._set.length} context:${S.inspect(e,{showHidden:!0,depth:2,colors:!0})}`)}return e};W.prototype.run=function(e){let t=this.createContext();this.enter(t);try{if(O){let s=R.triggerAsyncId(),n=R.executionAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);L(`${i}CONTEXT-RUN BEGIN: (${this.name}) currentUid:${E} triggerId:${s} asyncHooksCurrentId:${n} len:${this._set.length} context:${S.inspect(t)}`)}return e(t),t}catch(s){throw s&&(s[et]=t),s}finally{if(O){let s=R.triggerAsyncId(),n=R.executionAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);L(`${i}CONTEXT-RUN END: (${this.name}) currentUid:${E} triggerId:${s} asyncHooksCurrentId:${n} len:${this._set.length} ${S.inspect(t)}`)}this.exit(t)}};W.prototype.runAndReturn=function(e){let t;return this.run(function(s){t=e(s)}),t};W.prototype.runPromise=function(e){let t=this.createContext();this.enter(t);let s=e(t);if(!s||!s.then||!s.catch)throw new Error("fn must return a promise.");return O&&L("CONTEXT-runPromise BEFORE: ("+this.name+") currentUid:"+E+" len:"+this._set.length+" "+S.inspect(t)),s.then(n=>(O&&L("CONTEXT-runPromise AFTER then: ("+this.name+") currentUid:"+E+" len:"+this._set.length+" "+S.inspect(t)),this.exit(t),n)).catch(n=>{throw n[et]=t,O&&L("CONTEXT-runPromise AFTER catch: ("+this.name+") currentUid:"+E+" len:"+this._set.length+" "+S.inspect(t)),this.exit(t),n})};W.prototype.bind=function(e,t){t||(this.active?t=this.active:t=this.createContext());let s=this;return function(){s.enter(t);try{return e.apply(this,arguments)}catch(i){throw i&&(i[et]=t),i}finally{s.exit(t)}}};W.prototype.enter=function(e){if(ne.ok(e,"context must be provided for entering"),O){let t=R.executionAsyncId(),s=R.triggerAsyncId(),n=" ".repeat(this._indent<0?0:this._indent);L(`${n}CONTEXT-ENTER: (${this.name}) currentUid:${E} triggerId:${s} asyncHooksCurrentId:${t} len:${this._set.length} ${S.inspect(e)}`)}this._set.push(this.active),this.active=e};W.prototype.exit=function(e){if(ne.ok(e,"context must be provided for exiting"),O){let s=R.executionAsyncId(),n=R.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);L(`${i}CONTEXT-EXIT: (${this.name}) currentUid:${E} triggerId:${n} asyncHooksCurrentId:${s} len:${this._set.length} ${S.inspect(e)}`)}if(this.active===e){ne.ok(this._set.length,"can't remove top context"),this.active=this._set.pop();return}let t=this._set.lastIndexOf(e);t<0?(O&&L("??ERROR?? context exiting but not entered - ignoring: "+S.inspect(e)),ne.ok(t>=0,`context not currently entered; can't exit. 
`+S.inspect(this)+`
`+S.inspect(e))):(ne.ok(t,"can't remove top context"),this._set.splice(t,1))};W.prototype.bindEmitter=function(e){ne.ok(e.on&&e.addListener&&e.emit,"can only bind real EEs");let t=this,s="context@"+this.name;function n(o){o&&(o[Ze]||(o[Ze]=Object.create(null)),o[Ze][s]={namespace:t,context:t.active})}function i(o){if(!(o&&o[Ze]))return o;let a=o,u=o[Ze];return Object.keys(u).forEach(function(c){let l=u[c];a=l.namespace.bind(a,l.context)}),a}Nd(e,n,i)};W.prototype.fromException=function(e){return e[et]};function ii(r){return process.namespaces[r]}function Od(r){ne.ok(r,"namespace must be given a name."),O&&L(`NS-CREATING NAMESPACE (${r})`);let e=new W(r);return e.id=E,R.createHook({init(s,n,i,o){if(E=R.executionAsyncId(),e.active){if(e._contexts.set(s,e.active),O){let a=" ".repeat(e._indent<0?0:e._indent);L(`${a}INIT [${n}] (${r}) asyncId:${s} currentUid:${E} triggerId:${i} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${o}`)}}else if(E===0){let a=R.triggerAsyncId(),u=e._contexts.get(a);if(u){if(e._contexts.set(s,u),O){let c=" ".repeat(e._indent<0?0:e._indent);L(`${c}INIT USING CONTEXT FROM TRIGGERID [${n}] (${r}) asyncId:${s} currentUid:${E} triggerId:${a} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${o}`)}}else if(O){let c=" ".repeat(e._indent<0?0:e._indent);L(`${c}INIT MISSING CONTEXT [${n}] (${r}) asyncId:${s} currentUid:${E} triggerId:${a} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${o}`)}}if(O&&n==="PROMISE"){L(S.inspect(o,{showHidden:!0}));let a=o.parentId,u=" ".repeat(e._indent<0?0:e._indent);L(`${u}INIT RESOURCE-PROMISE [${n}] (${r}) parentId:${a} asyncId:${s} currentUid:${E} triggerId:${i} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${o}`)}},before(s){E=R.executionAsyncId();let n;if(n=e._contexts.get(s)||e._contexts.get(E),n){if(O){let i=R.triggerAsyncId(),o=" ".repeat(e._indent<0?0:e._indent);L(`${o}BEFORE (${r}) asyncId:${s} currentUid:${E} triggerId:${i} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${S.inspect(n)}`),e._indent+=2}e.enter(n)}else if(O){let i=R.triggerAsyncId(),o=" ".repeat(e._indent<0?0:e._indent);L(`${o}BEFORE MISSING CONTEXT (${r}) asyncId:${s} currentUid:${E} triggerId:${i} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} namespace._contexts:${S.inspect(e._contexts,{showHidden:!0,depth:2,colors:!0})}`),e._indent+=2}},after(s){E=R.executionAsyncId();let n;if(n=e._contexts.get(s)||e._contexts.get(E),n){if(O){let i=R.triggerAsyncId();e._indent-=2;let o=" ".repeat(e._indent<0?0:e._indent);L(`${o}AFTER (${r}) asyncId:${s} currentUid:${E} triggerId:${i} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${S.inspect(n)}`)}e.exit(n)}else if(O){let i=R.triggerAsyncId();e._indent-=2;let o=" ".repeat(e._indent<0?0:e._indent);L(`${o}AFTER MISSING CONTEXT (${r}) asyncId:${s} currentUid:${E} triggerId:${i} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${S.inspect(n)}`)}},destroy(s){if(E=R.executionAsyncId(),O){let n=R.triggerAsyncId(),i=" ".repeat(e._indent<0?0:e._indent);L(`${i}DESTROY (${r}) currentUid:${E} asyncId:${s} triggerId:${n} active:${S.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${S.inspect(e._contexts.get(E))}`)}e._contexts.delete(s)}}).enable(),process.namespaces[r]=e,e}function oi(r){let e=ii(r);ne.ok(e,`can't delete nonexistent namespace! "`+r+'"'),ne.ok(e.id,"don't assign to process.namespaces directly! "+S.inspect(e)),process.namespaces[r]=null}function qd(){process.namespaces&&Object.keys(process.namespaces).forEach(function(r){oi(r)}),process.namespaces=Object.create(null)}process.namespaces={};function L(...r){O&&process._rawDebug(`${S.format(...r)}`)}});var N=f((qE,di)=>{"use strict";var Kr=["debug","info","warn","error","silent"],ci=Kr.indexOf("error"),xd=Md(process.env.AWS_XRAY_DEBUG_MODE?"debug":process.env.AWS_XRAY_LOG_LEVEL),li={error:jt("error"),info:jt("info"),warn:jt("warn"),debug:jt("debug")};function jt(r){var e=Kr.indexOf(r),t=console[r]||console.log||(()=>{});return e>=xd?(s,n)=>{(s||n)&&t(kd(r,s,n))}:()=>{}}function Md(r){if(r){var e=r.toLowerCase(),t=Kr.indexOf(e);return t>=0?t:ci}return ci}function Dd(r){var e=-r.getTimezoneOffset(),t=e>=0?"+":"-",s=function(n){var i=Math.floor(Math.abs(n));return(i<10?"0":"")+i};return new Date(r.getTime()+e*60*1e3).toISOString().replace(/T/," ").replace(/Z/," ")+t+s(e/60)+":"+s(e%60)}function $d(){return process.env.LAMBDA_TASK_ROOT!==void 0}function kd(r,e,t){var s=[];$d()||(s.push(Dd(new Date)),s.push(`[${r.toUpperCase()}]`)),e&&s.push(e);var n=s.join(" "),i=Pd(t);return[n,i].filter(o=>o.length>0).join(`
  `)}function Pd(r){return r?typeof r=="string"?r:JSON.stringify(r):""}var Fd={setLogger:function(e){li=e},getLogger:function(){return li}};di.exports=Fd});var Hr=f((xE,hi)=>{"use strict";var Bd=require("crypto");function fi(r,e){this.init(r,e)}fi.prototype.init=function(e,t){var s=typeof e=="string"||e instanceof String?{message:e,name:""}:e;if(this.message=s.message,this.type=s.name,this.stack=[],this.remote=!!t,this.id=Bd.randomBytes(8).toString("hex"),s.stack){var n=s.stack.split(`
`);n.shift(),n.forEach(i=>{var o=i.trim().replace(/\(|\)/g,"");o=o.substring(o.indexOf(" ")+1);var a=o.lastIndexOf(" ")>=0?o.slice(0,o.lastIndexOf(" ")):null,u=Array.isArray(a)&&!a.length?o:o.slice(o.lastIndexOf(" ")+1);u=u.split(":");var c={path:u[0],line:parseInt(u[1]),label:a||"anonymous"};this.stack.push(c)},this)}};hi.exports=fi});var gi=f((ME,pi)=>{pi.exports=Ud;function Ud(r){var e=!1,t=null,s=null,n=null;return o;function i(a){n&&Gd(n,a),e=!1,n=s;var u=t;if(t=null,s=null,!u||!u.length){if(!n||!n.length){n=null;return}u||(u=[])}e=!0,r(u,i)}function o(a,u){e?(t||(t=[],s=[]),jd(t,a),u&&s.push(u)):(u&&(n=[u]),e=!0,r(Array.isArray(a)?a:[a],i))}}function jd(r,e){Array.isArray(e)?Wd(r,e):r.push(e)}function Wd(r,e){for(var t=0;t<e.length;t++)r.push(e[t])}function Gd(r,e){for(var t=0;t<r.length;t++)r[t](e)}});var Wt=f((DE,Ei)=>{"use strict";var mi=N(),H={udp_ip:"127.0.0.1",udp_port:2e3,tcp_ip:"127.0.0.1",tcp_port:2e3,setDaemonAddress:function(e){process.env.AWS_XRAY_DAEMON_ADDRESS?mi.getLogger().warn("Ignoring call to setDaemonAddress as AWS_XRAY_DAEMON_ADDRESS is set. The current daemon address will not be changed."):(vi(e),mi.getLogger().info("Configured daemon address to "+e+"."))}},vi=function(e){if(e.indexOf(":")===-1)throw new Error("Invalid Daemon Address. You must specify an ip and port.");var t=e.split(" ");if(t.length===1){if(e.indexOf("udp")>-1||e.indexOf("tcp")>-1)throw new Error("Invalid Daemon Address. You must specify both tcp and udp addresses.");var s=e.split(":");if(!s[0])throw new Error("Invalid Daemon Address. You must specify an ip.");H.udp_ip=s[0],H.tcp_ip=s[0],H.udp_port=s[1],H.tcp_port=s[1]}else if(t.length===2){var n=t[0].split(":"),i=t[1].split(":"),o={};if(o[n[0]]=n,o[i[0]]=i,H.udp_ip=o.udp[1],H.udp_port=parseInt(o.udp[2]),H.tcp_ip=o.tcp[1],H.tcp_port=parseInt(o.tcp[2]),!H.udp_port||!H.tcp_port)throw new Error("Invalid Daemon Address. You must specify port number.")}};process.env.AWS_XRAY_DAEMON_ADDRESS&&vi(process.env.AWS_XRAY_DAEMON_ADDRESS);Ei.exports=H});var Vt=f(($E,Ai)=>{"use strict";var bi=require("dgram"),Vd=gi(),Gt=N(),Si='{"format":"json","version":1}',_i=`
`;function Xd(r,e){var t=bi.createSocket("udp4");yi(t,r,0,function(){try{t.close()}finally{e()}})}function yi(r,e,t,s){if(t>=e.length){s();return}Kd(r,e[t],function(){yi(r,e,t+1,s)})}function Kd(r,e,t){var s=e.msg,n=e.offset,i=e.length,o=e.port,a=e.address,u=e.callback;r.send(s,n,i,o,a,function(c){try{u(c)}finally{t()}})}function Ti(){this.batchSend=Vd(Xd)}Ti.prototype.send=function(r,e,t,s,n,i){var o={msg:r,offset:e,length:t,port:s,address:n,callback:i};this.batchSend(o)};var Hd={daemonConfig:Wt(),format:function(e){return Si+_i+e.toString()},send:function(e){this.socket||(this.useBatchingTemporarySocket?this.socket=new Ti:this.socket=bi.createSocket("udp4").unref());var t=this.socket,s=e.format(),n=Si+_i+s,i=Buffer.from(n),o='{"trace_id:"'+e.trace_id+'","id":"'+e.id+'"}',a=e.type==="subsegment"?"Subsegment":"Segment";t.send(i,0,i.length,this.daemonConfig.udp_port,this.daemonConfig.udp_ip,function(u){u?u.code==="EMSGSIZE"?Gt.getLogger().error(a+" too large to send: "+o+" ("+i.length+" bytes)."):Gt.getLogger().error("Error occured sending segment: ",u):(Gt.getLogger().debug(a+' sent: {"trace_id:"'+e.trace_id+'","id":"'+e.id+'"}'),Gt.getLogger().debug("UDP message sent: "+e))})},setDaemonAddress:function(e){this.daemonConfig.setDaemonAddress(e)},getIp:function(){return this.daemonConfig.udp_ip},getPort:function(){return this.daemonConfig.udp_port},disableReusableSocket:function(){this.useBatchingTemporarySocket=!0}};Ai.exports=Hd});var Kt=f((kE,Ri)=>{"use strict";var zd=require("crypto"),Xt=N(),zr=class r{constructor(e,t){this.version=1,this.timestamp=e||Math.round(new Date().getTime()/1e3).toString(16),this.id=t||zd.randomBytes(12).toString("hex")}static Invalid(){return new r("00000000","000000000000000000000000")}static FromString(e){let t="-";var s=new r,n,i;if(!e||typeof e!="string")return Xt.getLogger().error("Empty or non-string trace ID provided"),s;let o=e.trim().split(t);return o.length!==3?(Xt.getLogger().error("Unrecognized trace ID format"),s):(n=parseInt(o[0]),isNaN(n)||n<1?(Xt.getLogger().error("Trace ID version must be positive integer"),s):(i=parseInt(o[1],16).toString(16),i==="NaN"?(Xt.getLogger().error("Trace ID timestamp must be a hex-encoded value"),s):(i=i.padStart(8,"0"),s.version=n,s.timestamp=i,s.id=o[2],s)))}toString(){return`${this.version.toString()}-${this.timestamp}-${this.id}`}};Ri.exports=zr});var $=f((PE,wi)=>{"use strict";var Yd=require("crypto"),tt=N(),Qd=Kt(),Yr={getCauseTypeFromHttpStatus:function(e){var t=e.toString();if(t.match(/^[4][0-9]{2}$/)!==null)return"error";if(t.match(/^[5][0-9]{2}$/)!==null)return"fault"},stripQueryStringFromPath:function(e){return e?e.split("?")[0]:""},wildcardMatch:function(e,t){if(e===void 0||t===void 0)return!1;if(e.length===1&&e.charAt(0)==="*")return!0;var s=e.length,n=t.length,i=e.indexOf("*");if(e=e.toLowerCase(),t=t.toLowerCase(),i===-1||i===s-1){var o=function(){for(var m=0,h=0;h<s;h++){var b=e.charAt(h);if(b==="*")return!0;if(b==="?"){if(m===n)return!1;m++}else{if(m>=n||b!=t.charAt(m))return!1;m++}}return m===n};return o()}var a=[];a[0]=!0;for(var u=0;u<s;u++){var c,l=e.charAt(u);if(l!="*")for(c=n-1;c>=0;c--)a[c+1]=!!a[c]&&(l==="?"||l===t.charAt(c));else{for(c=0;c<=n&&!a[c];)c++;for(c;c<=n;c++)a[c]=!0}a[0]=a[0]&&l==="*"}return a[n]},LambdaUtils:{validTraceData:function(r){var e=!1;if(r){var t=Yr.processTraceData(r);e=!!(t&&t.root&&t.parent&&t.sampled)}return e},populateTraceData:function(r,e){tt.getLogger().debug("Lambda trace data found: "+e);let t=Yr.processTraceData(e);var s=!1;return t?t.root&&!t.parent&&!t.sampled?(r.noOp=!0,s=!0):!t.root||!t.parent||!t.sampled?tt.getLogger().error("_X_AMZN_TRACE_ID is missing required information"):s=!0:(t={},tt.getLogger().error("_X_AMZN_TRACE_ID is empty or has an invalid format")),r.trace_id=Qd.FromString(t.root).toString(),r.id=t.parent||Yd.randomBytes(8).toString("hex"),t.root&&r.trace_id!==t.root&&(tt.getLogger().error("_X_AMZN_TRACE_ID contains invalid trace ID"),s=!1),parseInt(t.sampled)?delete r.notTraced:r.notTraced=!0,t.data&&(r.additionalTraceData=t.data),tt.getLogger().debug("Segment started: "+JSON.stringify(t)),s}},processTraceData:function(e){var t={},s={},n=["root","parent","sampled","self"],i=256;return typeof e=="string"&&e&&(e.split(";").forEach(function(o){if(o){var a=o.split("=");if(a[0]&&a[1]){let u=a[0].trim(),c=a[1].trim(),l=u.toLowerCase(),d=n.indexOf(l)!==-1;d?t[l]=c:!d&&i-(l.length+c.length)>=0&&(s[u]=c,i-=u.length+c.length)}}}),t.data=s),t},objectWithoutProperties:function(e,t,s){t=Array.isArray(t)?t:[],s=typeof s=="boolean"?s:!1;var n=s?Object.create(Object.getPrototypeOf(e)):{};for(var i in e)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n},safeParseInt:r=>!r||isNaN(r)?0:parseInt(r)};wi.exports=Yr});var le=f((FE,Li)=>{"use strict";var{safeParseInt:Ci}=$(),Ii=N(),Jd=100,Qr={streamingThreshold:Jd,getCurrentTime:function(){return Date.now()/1e3},setOrigin:function(e){this.origin=e},setPluginData:function(e){this.pluginData=e},setSDKData:function(e){this.sdkData=e},setServiceData:function(e){this.serviceData=e},setStreamingThreshold:function(e){isFinite(e)&&e>=0?(Qr.streamingThreshold=e,Ii.getLogger().debug("Subsegment streaming threshold set to: "+e)):Ii.getLogger().error("Invalid threshold: "+e+". Must be a whole number >= 0.")},getStreamingThreshold:function(){return Qr.streamingThreshold},getHttpResponseData:r=>{let e={};if(!r)return e;let t=Ci(r.statusCode);return t!==0&&(e.status=t),r.headers&&r.headers["content-length"]&&(e.content_length=Ci(r.headers["content-length"])),e},getJsonStringifyReplacer:()=>(r,e)=>typeof e=="bigint"?e.toString():e};Li.exports=Qr});var qi=f((BE,Oi)=>{"use strict";var{getHttpResponseData:Zd}=le(),{stripQueryStringFromPath:ef}=$();function Ni(r,e,t){this.init(r,e,t)}Ni.prototype.init=function(e,t,s){this.request={url:e.agent&&e.agent.protocol?e.agent.protocol+"//"+(e.host||e.getHeader("host"))+ef(e.path):"",method:e.method||""},s&&(this.request.traced=!0),t&&(this.response=Zd(t))};Oi.exports=Ni});var rt=f((UE,xi)=>{"use strict";var tf=require("crypto"),rf=Hr(),sf=qi(),nf=Vt(),Ht=le(),of=$(),ie=N();function _(r){this.init(r)}_.prototype.init=function(e){if(typeof e!="string")throw new Error("Subsegment name must be of type string.");this.id=tf.randomBytes(8).toString("hex"),this.name=e,this.start_time=Ht.getCurrentTime(),this.in_progress=!0,this.counter=0,this.notTraced=!1};_.prototype.addNewSubsegment=function(e){let t=new _(e);return this.addSubsegment(t),t};_.prototype.addSubsegmentWithoutSampling=function(e){this.addSubsegment(e),e.notTraced=!0};_.prototype.addNewSubsegmentWithoutSampling=function(e){let t=new _(e);return this.addSubsegment(t),t.notTraced=!0,t};_.prototype.addSubsegment=function(r){if(!(r instanceof _))throw new Error("Failed to add subsegment:"+r+' to subsegment "'+this.name+'".  Not a subsegment.');this.subsegments===void 0&&(this.subsegments=[]),r.segment=this.segment,r.parent=this,r.notTraced=r.parent.notTraced,r.noOp=r.parent.noOp,r.end_time===void 0&&this.incrementCounter(r.counter),this.subsegments.push(r)};_.prototype.removeSubsegment=function(e){if(!(e instanceof _))throw new Error("Failed to remove subsegment:"+e+' from subsegment "'+this.name+'".  Not a subsegment.');if(this.subsegments!==void 0){var t=this.subsegments.indexOf(e);t>=0&&this.subsegments.splice(t,1)}};_.prototype.addAttribute=function(e,t){this[e]=t};_.prototype.addPrecursorId=function(r){typeof r!="string"&&ie.getLogger().error("Failed to add id:"+r+" to subsegment "+this.name+".  Precursor Ids must be of type string."),this.precursor_ids===void 0&&(this.precursor_ids=[]),this.precursor_ids.push(r)};_.prototype.addAnnotation=function(r,e){if(typeof e!="boolean"&&typeof e!="string"&&!isFinite(e)){ie.getLogger().error("Failed to add annotation key: "+r+" value: "+e+" to subsegment "+this.name+". Value must be of type string, number or boolean.");return}if(typeof r!="string"){ie.getLogger().error("Failed to add annotation key: "+r+" value: "+e+" to subsegment "+this.name+". Key must be of type string.");return}this.annotations===void 0&&(this.annotations={}),this.annotations[r]=e};_.prototype.addMetadata=function(r,e,t){if(typeof r!="string"){ie.getLogger().error("Failed to add metadata key: "+r+" value: "+e+" to subsegment "+this.name+". Key must be of type string.");return}if(t&&typeof t!="string"){ie.getLogger().error("Failed to add metadata key: "+r+" value: "+e+" to subsegment "+this.name+". Namespace must be of type string.");return}var s=t||"default";this.metadata||(this.metadata={}),this.metadata[s]||(this.metadata[s]={}),s!=="__proto__"&&(this.metadata[s][r]=e??"")};_.prototype.addSqlData=function(e){this.sql=e};_.prototype.addError=function(e,t){if(e==null||typeof e!="object"&&typeof e!="string"){ie.getLogger().error("Failed to add error:"+e+' to subsegment "'+this.name+'".  Not an object or string literal.');return}if(this.addFaultFlag(),this.segment&&this.segment.exception){if(e===this.segment.exception.ex){this.fault=!0,this.cause={id:this.segment.exception.cause,exceptions:[]};return}delete this.segment.exception}this.segment&&(this.segment.exception={ex:e,cause:this.id}),this.cause===void 0&&(this.cause={working_directory:process.cwd(),exceptions:[]}),this.cause.exceptions.unshift(new rf(e,t))};_.prototype.addRemoteRequestData=function(e,t,s){this.http=new sf(e,t,s),"traced"in this.http.request&&(this.traced=this.http.request.traced,delete this.http.request.traced)};_.prototype.addFaultFlag=function(){this.fault=!0};_.prototype.addErrorFlag=function(){this.error=!0};_.prototype.addThrottleFlag=function(){this.throttle=!0};_.prototype.close=function(e,t){var s=this.segment;this.end_time=Ht.getCurrentTime(),delete this.in_progress,e&&this.addError(e,t),this.parent&&this.parent.decrementCounter(),s&&s.counter>Ht.getStreamingThreshold()&&this.streamSubsegments()&&this.parent&&this.parent.removeSubsegment(this)};_.prototype.incrementCounter=function(e){this.counter=e?this.counter+e+1:this.counter+1,this.parent&&this.parent.incrementCounter(e)};_.prototype.decrementCounter=function(){this.counter--,this.parent&&this.parent.decrementCounter()};_.prototype.isClosed=function(){return!this.in_progress};_.prototype.flush=function(){if(!this.parent||!this.segment){ie.getLogger().error("Failed to flush subsegment: "+this.name+". Subsegment must be added to a segment chain to flush.");return}this.segment.trace_id?this.segment.notTraced!==!0&&!this.notTraced?nf.send(this):ie.getLogger().debug("Ignoring flush on subsegment "+this.id+". Associated segment is marked as not sampled."):ie.getLogger().debug("Ignoring flush on subsegment "+this.id+". Associated segment is missing a trace ID.")};_.prototype.streamSubsegments=function(){if(this.isClosed()&&this.counter<=0)return this.flush(),!0;if(this.subsegments&&this.subsegments.length>0){var e=[];this.subsegments.forEach(function(t){t.streamSubsegments()||e.push(t)}),this.subsegments=e}};_.prototype.format=function(){return this.type="subsegment",this.parent&&(this.parent_id=this.parent.id),this.segment&&(this.trace_id=this.segment.trace_id),this.serialize()};_.prototype.toString=function(){return this.serialize()};_.prototype.toJSON=function(){var e=["segment","parent","counter"];(this.subsegments==null||this.subsegments.length===0)&&e.push("subsegments");var t=of.objectWithoutProperties(this,e,!1);return t};_.prototype.serialize=function(e){return JSON.stringify(e??this,Ht.getJsonStringifyReplacer())};xi.exports=_});var st=f((jE,$i)=>{"use strict";var af=require("crypto"),uf=Hr(),cf=Vt(),G=le(),zt=rt(),Mi=Kt(),Di=$(),de=N();function T(r,e,t){this.init(r,e,t)}T.prototype.init=function(e,t,s){if(typeof e!="string")throw new Error("Segment name must be of type string.");var n;t&&typeof t=="string"?n=Mi.FromString(t):n=new Mi;var i=af.randomBytes(8).toString("hex"),o=G.getCurrentTime();this.trace_id=n.toString(),this.id=i,this.start_time=o,this.name=e||"",this.in_progress=!0,this.counter=0,s&&(this.parent_id=s),G.serviceData&&this.setServiceData(G.serviceData),G.pluginData&&this.addPluginData(G.pluginData),G.origin&&(this.origin=G.origin),G.sdkData&&this.setSDKData(G.sdkData)};T.prototype.addIncomingRequestData=function(e){this.http=e};T.prototype.addAnnotation=function(e,t){if(typeof t!="boolean"&&typeof t!="string"&&!isFinite(t)){de.getLogger().error("Failed to add annotation key: "+e+" value: "+t+" to subsegment "+this.name+". Value must be of type string, number or boolean.");return}if(typeof e!="string"){de.getLogger().error("Failed to add annotation key: "+e+" value: "+t+" to subsegment "+this.name+". Key must be of type string.");return}this.annotations===void 0&&(this.annotations={}),this.annotations[e]=t};T.prototype.setUser=function(r){typeof r!="string"&&de.getLogger().error("Set user: "+r+" failed. User IDs must be of type string."),this.user=r};T.prototype.addMetadata=function(r,e,t){if(typeof r!="string"){de.getLogger().error("Failed to add metadata key: "+r+" value: "+e+" to segment "+this.name+". Key must be of type string.");return}if(t&&typeof t!="string"){de.getLogger().error("Failed to add metadata key: "+r+" value: "+e+" to segment "+this.name+". Namespace must be of type string.");return}var s=t||"default";this.metadata||(this.metadata={}),this.metadata[s]||(this.metadata[s]={}),s!=="__proto__"&&(this.metadata[s][r]=e??"")};T.prototype.setSDKData=function(e){if(!e){de.getLogger().error("Add SDK data: "+e+" failed.Must not be empty.");return}this.aws||(this.aws={}),this.aws.xray=e};T.prototype.setMatchedSamplingRule=function(e){this.aws&&(this.aws=JSON.parse(JSON.stringify(this.aws))),this.aws&&this.aws.xray?this.aws.xray.rule_name=e:this.aws={xray:{rule_name:e}}};T.prototype.setServiceData=function(e){if(!e){de.getLogger().error("Add service data: "+e+" failed.Must not be empty.");return}this.service=e};T.prototype.addPluginData=function(e){this.aws===void 0&&(this.aws={}),Object.assign(this.aws,e)};T.prototype.addNewSubsegment=function(e){var t=new zt(e);return this.addSubsegment(t),t};T.prototype.addSubsegmentWithoutSampling=function(e){this.addSubsegment(e),e.notTraced=!0};T.prototype.addNewSubsegmentWithoutSampling=function(e){let t=new zt(e);return this.addSubsegment(t),t.notTraced=!0,t};T.prototype.addSubsegment=function(e){if(!(e instanceof zt))throw new Error("Cannot add subsegment: "+e+". Not a subsegment.");this.subsegments===void 0&&(this.subsegments=[]),e.segment=this,e.parent=this,e.notTraced=e.parent.notTraced,e.noOp=e.parent.noOp,this.subsegments.push(e),e.end_time||this.incrementCounter(e.counter)};T.prototype.removeSubsegment=function(e){if(!(e instanceof zt))throw new Error("Failed to remove subsegment:"+e+' from subsegment "'+this.name+'".  Not a subsegment.');if(this.subsegments!==void 0){var t=this.subsegments.indexOf(e);t>=0&&this.subsegments.splice(t,1)}};T.prototype.addError=function(e,t){if(e==null||typeof e!="object"&&typeof e!="string"){de.getLogger().error("Failed to add error:"+e+' to subsegment "'+this.name+'".  Not an object or string literal.');return}if(this.addFaultFlag(),this.exception){if(e===this.exception.ex){this.cause={id:this.exception.cause},delete this.exception;return}delete this.exception}this.cause===void 0&&(this.cause={working_directory:process.cwd(),exceptions:[]}),this.cause.exceptions.push(new uf(e,t))};T.prototype.addFaultFlag=function(){this.fault=!0};T.prototype.addErrorFlag=function(){this.error=!0};T.prototype.addThrottleFlag=function(){this.throttle=!0};T.prototype.isClosed=function(){return!this.in_progress};T.prototype.incrementCounter=function(e){if(this.counter=e?this.counter+e+1:this.counter+1,this.counter>G.streamingThreshold&&this.subsegments&&this.subsegments.length>0){var t=[];this.subsegments.forEach(function(s){s.streamSubsegments()||t.push(s)}),this.subsegments=t}};T.prototype.decrementCounter=function(){this.counter--,this.counter<=0&&this.isClosed()&&this.flush()};T.prototype.close=function(r,e){this.end_time||(this.end_time=G.getCurrentTime()),r!==void 0&&this.addError(r,e),delete this.in_progress,delete this.exception,this.counter<=0&&this.flush()};T.prototype.flush=function(){if(this.notTraced!==!0){delete this.exception;var e=Di.objectWithoutProperties(this,["counter","notTraced"],!0);cf.send(e)}};T.prototype.format=function(){var e=["segment","parent","counter"];(this.subsegments==null||this.subsegments.length===0)&&e.push("subsegments");var t=Di.objectWithoutProperties(this,e,!1);return this.serialize(t)};T.prototype.toString=function(){return this.serialize()};T.prototype.serialize=function(e){return JSON.stringify(e??this,G.getJsonStringifyReplacer())};$i.exports=T});var he=f((WE,Bi)=>{"use strict";var nt=ui(),z=N(),Jr=st(),ki=rt(),oe=!0,fe="AWSXRay",Pi="segment",Fi=!1,k={CONTEXT_MISSING_STRATEGY:{RUNTIME_ERROR:{contextMissing:function(e){throw new Error(e)}},LOG_ERROR:{contextMissing:function(e){var t=new Error(e);z.getLogger().error(t.stack)}},IGNORE_ERROR:{contextMissing:function(){}}},contextMissingStrategy:{},resolveManualSegmentParams:function(e){if(e&&!k.isAutomaticMode()){var t=e.XRaySegment||e.XraySegment,s=e.Segment,n=null;return t&&(t instanceof Jr||t instanceof ki)?(n=t,delete e.XRaySegment,delete e.XraySegment):s&&(s instanceof Jr||s instanceof ki)&&(n=s,delete e.Segment),n}},getNamespace:function(){return nt.getNamespace(fe)||nt.createNamespace(fe)},resolveSegment:function(e){if(oe)return this.getSegment();if(e&&!oe)return e;!e&&!oe&&k.contextMissingStrategy.contextMissing("No sub/segment specified. A sub/segment must be provided for manual mode.")},getSegment:function(){if(oe){var e=k.getNamespace(fe).get(Pi);return e?e instanceof Jr&&process.env.LAMBDA_TASK_ROOT&&e.facade==!0&&e.resolveLambdaTraceData():k.contextMissingStrategy.contextMissing("Failed to get the current sub/segment from the context."),e}else k.contextMissingStrategy.contextMissing("Cannot get sub/segment from context. Not supported in manual mode.")},setSegment:function(e){oe?k.getNamespace(fe).set(Pi,e)||z.getLogger().warn("Failed to set the current sub/segment on the context."):k.contextMissingStrategy.contextMissing("Cannot set sub/segment on context. Not supported in manual mode.")},isAutomaticMode:function(){return oe},enableAutomaticMode:function(){oe=!0,k.getNamespace(fe),z.getLogger().debug("Overriding AWS X-Ray SDK mode. Set to automatic mode.")},enableManualMode:function(){oe=!1,nt.getNamespace(fe)&&nt.destroyNamespace(fe),z.getLogger().debug("Overriding AWS X-Ray SDK mode. Set to manual mode.")},setContextMissingStrategy:function(e){if(Fi)z.getLogger().warn("Ignoring call to setContextMissingStrategy as AWS_XRAY_CONTEXT_MISSING is set. The current context missing strategy will not be changed.");else if(typeof e=="string"){var t=k.CONTEXT_MISSING_STRATEGY[e.toUpperCase()];if(t)k.contextMissingStrategy.contextMissing=t.contextMissing,process.env.AWS_XRAY_CONTEXT_MISSING?z.getLogger().debug("AWS_XRAY_CONTEXT_MISSING is set. Configured context missing strategy to "+process.env.AWS_XRAY_CONTEXT_MISSING+"."):z.getLogger().debug("Configured context missing strategy to: "+e);else throw new Error("Invalid context missing strategy: "+e+". Valid values are "+Object.keys(k.CONTEXT_MISSING_STRATEGY)+".")}else if(typeof e=="function")k.contextMissingStrategy.contextMissing=e,z.getLogger().info("Configured custom context missing strategy to function: "+e.name);else throw new Error("Context missing strategy must be either a string or a custom function.")}};process.env.AWS_XRAY_MANUAL_MODE?(oe=!1,z.getLogger().debug("Starting the AWS X-Ray SDK in manual mode.")):(nt.createNamespace(fe),z.getLogger().debug("Starting the AWS X-Ray SDK in automatic mode (default)."));process.env.AWS_XRAY_CONTEXT_MISSING?(k.setContextMissingStrategy(process.env.AWS_XRAY_CONTEXT_MISSING),Fi=!0):(k.contextMissingStrategy.contextMissing=k.CONTEXT_MISSING_STRATEGY.LOG_ERROR.contextMissing,z.getLogger().debug("Using default context missing strategy: LOG_ERROR"));Bi.exports=k});var es=f((GE,Ui)=>{"use strict";var{getHttpResponseData:lf}=le();function Zr(r){this.init(r)}Zr.prototype.init=function(e){var t=!!e.headers["x-forwarded-for"],s;e.connection&&(s=(e.connection.secure||e.connection.encrypted?"https://":"http://")+((e.headers.host||"")+(e.url||""))),this.request={method:e.method||"",user_agent:e.headers["user-agent"]||"",client_ip:df(e)||"",url:s||""},t&&(this.request.x_forwarded_for=t)};var df=function(e){var t;return e.headers["x-forwarded-for"]?t=(e.headers["x-forwarded-for"]||"").split(",")[0]:e.connection&&e.connection.remoteAddress?t=e.connection.remoteAddress:e.socket&&e.socket.remoteAddress?t=e.socket.remoteAddress:e.connection&&e.connection.socket&&e.connection.socket.remoteAddress&&(t=e.connection.socket.remoteAddress),t};Zr.prototype.close=function(e){this.response=lf(e)};Ui.exports=Zr});var Wi=f((VE,ji)=>{"use strict";function ts(r,e){this.init(r,e)}ts.prototype.init=function(e,t){if(this.usedThisSecond=0,typeof e=="number"&&e%1===0&&e>=0)this.fixedTarget=e;else throw new Error('Error in sampling file. Rule attribute "fixed_target" must be a non-negative integer.');if(typeof t=="number"&&t>=0&&t<=1)this.fallbackRate=t;else throw new Error('Error in sampling file. Rule attribute "rate" must be a number between 0 and 1 inclusive.')};ts.prototype.isSampled=function(){var e=Math.round(new Date().getTime()/1e3);return e!==this.thisSecond&&(this.usedThisSecond=0,this.thisSecond=e),this.usedThisSecond>=this.fixedTarget?Math.random()<this.fallbackRate:(this.usedThisSecond++,!0)};ji.exports=ts});var Gi=f((XE,ff)=>{ff.exports={default:{fixed_target:1,rate:.05},version:2}});var ss=f((KE,zi)=>{"use strict";var hf=require("fs"),Vi=Wi(),rs=$(),pf=Gi(),Yt=N(),Ki={shouldSample:function(e){var t=e.host,s=e.httpMethod,n=e.urlPath,i="{ http_method: "+s+", host: "+t+", url_path: "+n+" }",o;return this.rules.some(function(a){if(a.default||t==null||rs.wildcardMatch(a.host,t)&&(s==null||rs.wildcardMatch(a.http_method,s))&&(n==null||rs.wildcardMatch(a.url_path,n)))return o=a.reservoir,Yt.getLogger().debug("Local sampling rule match found for "+i+". Matched "+(a.default?"default":"{ http_method: "+a.http_method+", host: "+a.host+", url_path: "+a.url_path+" }")+". Using fixed_target: "+o.fixedTarget+" and rate: "+o.fallbackRate+"."),!0}),o?o.isSampled():(Yt.getLogger().debug("No sampling rule matched for "+i),!1)},setLocalRules:function(e){e?typeof e=="string"?(Yt.getLogger().info("Using custom sampling rules file: "+e),this.rules=Xi(JSON.parse(hf.readFileSync(e,"utf8")))):(Yt.getLogger().info("Using custom sampling rules source."),this.rules=Xi(e)):this.rules=Hi(pf)}},Xi=function(e){if(!e.version)throw new Error('Error in sampling file. Missing "version" attribute.');if(e.version===1||e.version===2)return Hi(e);throw new Error('Error in sampling file. Unknown version "'+e.version+'".')},Hi=function(e){var t,s=[];if(e.default){var n=[];for(var i in e.default){if(i!=="fixed_target"&&i!=="rate")throw new Error("Error in sampling file. Invalid attribute for default: "+i+'. Valid attributes for default are "fixed_target" and "rate".');if(typeof e.default[i]!="number")throw new Error("Error in sampling file. Default "+i+" must be a number.")}if(typeof e.default.fixed_target>"u"&&n.push("fixed_target"),typeof e.default.rate>"u"&&n.push("rate"),n.length!==0)throw new Error("Error in sampling file. Missing required attributes for default: "+n+".");t={default:!0,reservoir:new Vi(e.default.fixed_target,e.default.rate)}}else throw new Error('Error in sampling file. Expecting "default" object to be defined with attributes "fixed_target" and "rate".');return Array.isArray(e.rules)&&e.rules.forEach(function(o){var a={},u;e.version===2&&(u={host:1,http_method:1,url_path:1,fixed_target:1,rate:1}),e.version===1&&(u={service_name:1,http_method:1,url_path:1,fixed_target:1,rate:1});for(var c in o){var l=o[c];if(!u[c]&&c!="description")throw new Error("Error in sampling file. Rule "+JSON.stringify(o)+" has invalid attribute: "+c+".");if(c!="description"&&!l&&l!==0)throw new Error("Error in sampling file. Rule "+JSON.stringify(o)+' attribute "'+c+'" has invalid value: '+l+".");e.version===2&&(a[c]=l),e.version===1&&c==="service_name"?a.host=l:a[c]=l,delete u[c]}if(Object.keys(u).length!==0&&u.constructor===Object)throw new Error("Error in sampling file. Rule "+JSON.stringify(o)+" is missing required attributes: "+Object.keys(u)+".");var d=a;d.reservoir=new Vi(o.fixed_target,o.rate),s.push(d)}),s.push(t),s};Ki.setLocalRules();zi.exports=Ki});var Qi=f((HE,Yi)=>{"use strict";function Ne(){this.init()}Ne.prototype.init=function(){this.quota=null,this.TTL=null,this.takenThisSec=0,this.borrowedThisSec=0,this.reportInterval=1,this.reportElapsed=0};Ne.prototype.borrowOrTake=function(e,t){if(this.adjustThisSec(e),this.quota>=0&&this.TTL>=e)return this.takenThisSec>=this.quota?!1:(this.takenThisSec++,"take");if(t)return this.borrowedThisSec>=1?!1:(this.borrowedThisSec++,"borrow")};Ne.prototype.adjustThisSec=function(e){e!==this.thisSec&&(this.takenThisSec=0,this.borrowedThisSec=0,this.thisSec=e)};Ne.prototype.loadNewQuota=function(e,t,s){e&&(this.quota=e),t&&(this.TTL=t),s&&(this.reportInterval=s/10)};Ne.prototype.timeToReport=function(){return this.reportElapsed+1>=this.reportInterval?(this.reportElapsed=0,!0):(this.reportElapsed+=1,!1)};Yi.exports=Ne});var Zi=f((zE,Ji)=>{"use strict";var it=$(),gf=Qi();function x(r,e,t,s,n,i,o,a,u){this.init(r,e,t,s,n,i,o,a,u)}x.prototype.init=function(e,t,s,n,i,o,a,u,c){this.name=e,this.priority=t,this.rate=s,this.host=i,this.httpMethod=o,this.urlPath=a,this.serviceName=u,this.serviceType=c,this.reservoir=new gf,this.borrow=!!n,this.resetStatistics()};x.prototype.match=function(e){var t=e.host,s=e.httpMethod,n=e.serviceName,i=e.urlPath,o=e.serviceType;return this.isDefault()||(!t||it.wildcardMatch(this.host,t))&&(!s||it.wildcardMatch(this.httpMethod,s))&&(!n||it.wildcardMatch(this.serviceName,n))&&(!i||it.wildcardMatch(this.urlPath,i))&&(!o||it.wildcardMatch(this.serviceType,o))};x.prototype.snapshotStatistics=function(){var e={requestCount:this.requestCount,borrowCount:this.borrowCount,sampledCount:this.sampledCount};return this.resetStatistics(),e};x.prototype.merge=function(e){this.reservoir=e.reservoir,this.requestCount=e.requestCount,this.borrowCount=e.borrowCount,this.sampledCount=e.sampledCount,e=null};x.prototype.isDefault=function(){return this.name==="Default"};x.prototype.incrementRequestCount=function(){this.requestCount++};x.prototype.incrementBorrowCount=function(){this.borrowCount++};x.prototype.incrementSampledCount=function(){this.sampledCount++};x.prototype.setRate=function(e){this.rate=e};x.prototype.getRate=function(){return this.rate};x.prototype.getName=function(){return this.name};x.prototype.getPriority=function(){return this.priority};x.prototype.getReservoir=function(){return this.reservoir};x.prototype.resetStatistics=function(){this.requestCount=0,this.borrowCount=0,this.sampledCount=0};x.prototype.canBorrow=function(){return this.borrow};x.prototype.everMatched=function(){return this.requestCount>0};x.prototype.timeToReport=function(){return this.reservoir.timeToReport()};Ji.exports=x});var ns=f((YE,so)=>{"use strict";var mf=require("crypto"),vf=N(),Ef=Zi(),Qt=Wt(),Sf=require("util"),_f=require("http"),to={clientId:mf.randomBytes(12).toString("hex"),samplingRulesPath:"/GetSamplingRules",samplingTargetsPath:"/SamplingTargets",logger:vf,httpClient:_f,fetchSamplingRules:function(e){let t="{}",s=eo(this.samplingRulesPath,t.length),i=(this.httpClient.__request?this.httpClient.__request:this.httpClient.request)(s,o=>{var a="";o.on("data",u=>{a+=u}),o.on("error",u=>{e(u)}),o.on("end",()=>{var u;try{u=JSON.parse(a)}catch(l){e(l);return}if(!u){e(new Error("AWS X-Ray GetSamplingRules API returned empty response"));return}var c=yf(u);e(null,c)})});i.on("error",()=>{e(new Error(`Failed to connect to X-Ray daemon at ${s.hostname}:${s.port} to get sampling rules.`))}),i.write(t),i.end()},fetchTargets:function(e,t){let s=JSON.stringify(bf(e)),n=eo(this.samplingTargetsPath,s.length),o=(this.httpClient.__request?this.httpClient.__request:this.httpClient.request)(n,a=>{var u="";a.on("data",c=>{u+=c}),a.on("error",c=>{t(c)}),a.on("end",()=>{var c;try{c=JSON.parse(u)}catch(m){t(m);return}if(!c||typeof c.LastRuleModification!="number"){t(new Error("AWS X-Ray SamplingTargets API returned invalid response"));return}var l=Tf(c),d=ro(c.LastRuleModification);t(null,l,d)})});o.on("error",()=>{t(new Error(`Failed to connect to X-Ray daemon at ${n.hostname}:${n.port} to get sampling targets.`))}),o.write(s),o.end()}},bf=function(e){var t=[],s=Math.floor(new Date().getTime()/1e3);return e.forEach(function(n){var i=n.snapshotStatistics(),o={RuleName:n.getName(),ClientID:to.clientId,RequestCount:i.requestCount,BorrowCount:i.borrowCount,SampledCount:i.sampledCount,Timestamp:s};t.push(o)}),{SamplingStatisticsDocuments:t}},yf=function(e){var t=[],s=e.SamplingRuleRecords||[];return s.forEach(function(n){if(n=n.SamplingRule,Af(n)){var i=new Ef(n.RuleName,n.Priority,n.FixedRate,n.ReservoirSize,n.Host,n.HTTPMethod,n.URLPath,n.ServiceName,n.ServiceType);t.push(i)}}),t},Tf=function(e){var t=e.SamplingTargetDocuments||[],s={};return t.forEach(function(n){var i={rate:n.FixedRate,quota:n.ReservoirQuota,TTL:ro(n.ReservoirQuotaTTL),interval:n.Interval};s[n.RuleName]=i}),s},Af=function(e){return e.Version===1&&e.ResourceARN==="*"&&e.Attributes&&Object.keys(e.Attributes).length===0&&e.ServiceType&&e.RuleName&&e.Priority&&typeof e.FixedRate=="number"},ro=function(e){return new Date(e).getTime()/1e3},eo=function(e,t){return{hostname:Qt.tcp_ip,port:Qt.tcp_port,method:"POST",path:e,headers:{"Content-Type":"application/json","Content-Length":t,Host:Sf.format("%s:%d",Qt.tcp_ip,Qt.tcp_port)}}};so.exports=to});var Jt=f((QE,no)=>{"use strict";var Rf=3600,is={rules:[],lastUpdated:null,getMatchedRule:function(e,t){if(wf(t))return null;var s;return this.rules.forEach(function(n){!s&&n.match(e)&&(s=n),n.isDefault()&&!s&&(s=n)}),s},loadRules:function(e){var t={};this.rules.forEach(function(s){t[s.getName()]=s}),this.rules=e,this.rules.forEach(function(s){var n=t[s.getName()];n&&s.merge(n)}),this.rules.sort(function(s,n){var i=s.getPriority()-n.getPriority();return i!==0?i:s.getName()>n.getName()?1:-1})},loadTargets:function(e){this.rules.forEach(function(t){var s=e[t.getName()];s&&(t.getReservoir().loadNewQuota(s.quota,s.TTL,s.interval),t.setRate(s.rate))})},getRules:function(){return this.rules},timestamp:function(e){this.lastUpdated=e},getLastUpdated:function(){return this.lastUpdated}},wf=function(e){return is.getLastUpdated()?e>is.getLastUpdated()+Rf:!0};no.exports=is});var as=f((JE,uo)=>{"use strict";var os=N(),Cf=ns(),io=Jt(),If=5*60*1e3,Lf={start:function(){this.poller&&clearInterval(this.poller),oo(!1),this.poller=setInterval(oo,If),this.poller.unref()}},oo=function(e){if(e=typeof e>"u"?!0:e,e){var t=Of();setTimeout(ao,t)}else ao()},ao=function(){try{Nf()}catch(e){os.getLogger().warn("Encountered unexpected exception when fetching sampling rules: "+e)}},Nf=function(){var e=Math.floor(new Date().getTime()/1e3);Cf.fetchSamplingRules(function(t,s){t?os.getLogger().warn("Failed to retrieve sampling rules from X-Ray service:",t):s.length!==0&&(io.loadRules(s),io.timestamp(e),os.getLogger().info("Successfully refreshed centralized sampling rule cache."))})},Of=function(){return Math.random()*5};uo.exports=Lf});var ho=f((ZE,fo)=>{"use strict";var qf=as(),xf=ns(),us=Jt(),Zt=N(),co=10*1e3,lo={interval:co,start:function(){this.poller=setInterval(Mf,co+kf()),this.poller.unref()}},Mf=function(){try{Df()}catch(e){Zt.getLogger().warn("Encountered unexpected exception when fetching sampling targets: "+e)}},Df=function(){var e=$f();e&&e.length>0&&xf.fetchTargets(e,function(t,s,n){if(t){Zt.getLogger().warn("Failed to retrieve sampling targets from X-Ray service:",t);return}us.loadTargets(s),n>us.getLastUpdated()&&(Zt.getLogger().info("Performing out-of-band sampling rule polling to fetch updated rules."),qf.start()),Zt.getLogger().info("Successfully reported rule statistics to get new sampling quota.")})},$f=function(){var e=us.getRules(),t=[];return e.forEach(function(s){s.everMatched()&&s.timeToReport()&&t.push(s)}),t},kf=function(){return Math.random()/lo.interval};fo.exports=lo});var go=f((eS,po)=>{"use strict";var cs=N(),Pf=require("util"),Ff=le(),Bf={localSampler:ss(),rulePoller:as(),targetPoller:ho(),ruleCache:Jt(),started:!1,shouldSample:function(e){try{this.started||this.start(),e.serviceType||(e.serviceType=Ff.origin);var t=Math.floor(new Date().getTime()/1e3),s=this.ruleCache.getMatchedRule(e,t);return s?(cs.getLogger().debug(Pf.format("Rule %s is matched.",s.getName())),Uf(s,t)):(cs.getLogger().info("No effective centralized sampling rule match. Fallback to local rules."),this.localSampler.shouldSample(e))}catch(n){cs.getLogger().error("Unhandled exception by the SDK during making sampling decisions: "+n)}},setLocalRules:function(e){this.localSampler.setLocalRules(e)},start:function(){this.started||(this.rulePoller.start(),this.targetPoller.start(),this.started=!0)}},Uf=function(e,t){e.incrementRequestCount();var s=e.getReservoir(),n=!0,i=s.borrowOrTake(t,e.canBorrow());return i==="borrow"?e.incrementBorrowCount():i==="take"||Math.random()<=e.getRate()?e.incrementSampledCount():n=!1,n?e.getName():!1};po.exports=Bf});var ds=f((tS,mo)=>{"use strict";var jf=st(),Wf=es(),Gf=N(),Vf=$(),Xf=$().wildcardMatch,Kf=$().processTraceData,ls="x-amzn-trace-id",Hf=!!process.env.AWS_XRAY_TRACING_NAME,zf={defaultName:process.env.AWS_XRAY_TRACING_NAME,dynamicNaming:!1,hostPattern:null,sampler:go(),enableDynamicNaming:function(r){if(this.dynamicNaming=!0,r&&typeof r!="string")throw new Error("Host pattern must be a string.");this.hostPattern=r||null},processHeaders:function(e){var t={};return e&&e.headers&&e.headers[ls]&&(t=Kf(e.headers[ls])),t},resolveName:function(e){var t;return this.dynamicNaming&&e?t=this.hostPattern?Xf(this.hostPattern,e)?e:this.defaultName:e:t=this.defaultName,t},resolveSampling:function(e,t,s){var n;if(e.sampled==="1")n=!0;else if(e.sampled==="0")n=!1;else{var i={host:s.req.headers.host,httpMethod:s.req.method,urlPath:s.req.url,serviceName:t.name};n=this.sampler.shouldSample(i),(n instanceof String||typeof n=="string")&&(t.setMatchedSamplingRule(n),n=!0)}e.sampled==="?"&&s.header&&s.header(ls,"Root="+e.root+";Sampled="+(n?"1":"0")),n||(t.notTraced=!0)},setDefaultName:function(e){Hf||(this.defaultName=e)},disableCentralizedSampling:function(){this.sampler=ss()},setSamplingRules:function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local sampling rules file, or supply an object containing the rules.");this.sampler.setLocalRules(e)},middlewareLog:function(e,t,s){Gf.getLogger().debug(e+": { url: "+t+", name: "+s.name+", trace_id: "+s.trace_id+", id: "+s.id+", sampled: "+!s.notTraced+" }")},traceRequestResponseCycle:function(e,t){var s=this.processHeaders(e),n=this.resolveName(e.headers.host),i=new jf(n,s.root,s.parent);t.req||(t.req=e),this.resolveSampling(s,i,t),i.addIncomingRequestData(new Wf(e)),this.middlewareLog("Starting middleware segment",e.url,i);var o=this.middlewareLog,a=!1,u=function(){if(a)return;a=!0,t.statusCode===429&&i.addThrottleFlag();let c=Vf.getCauseTypeFromHttpStatus(t.statusCode);c&&(i[c]=!0),i.http.close(t),i.close(),o("Closed middleware segment successfully",e.url,i)};return t.on("finish",u),t.on("close",u),i}};mo.exports=zf});var So=f((rS,Eo)=>{"use strict";var er=he(),Yf=ds(),fs=$().LambdaUtils,Qf=st(),Jf=Vt(),Zf=le(),ps=N(),vo=Kt(),hs=null;Eo.exports.init=function(){er.enableManualMode=function(){ps.getLogger().warn("AWS Lambda does not support AWS X-Ray manual mode.")},Jf.disableReusableSocket(),Zf.setStreamingThreshold(0),ps.getLogger().info("Disabling centralized sampling in Lambda environment."),Yf.disableCentralizedSampling();var e=er.getNamespace();e.enter(e.createContext()),er.setSegment(eh())};var eh=function(){var e=new Qf("facade"),t=["addNewSubsegment","addSubsegment","removeSubsegment","toString","addSubsegmentWithoutSampling","addNewSubsegmentWithoutSampling"],s=["incrementCounter","decrementCounter","isClosed","close","format","flush"],n=process.env._X_AMZN_TRACE_ID;for(var i in e)typeof e[i]=="function"&&t.indexOf(i)===-1&&(s.indexOf(i)===-1?e[i]=function(){var o=i;return function(){ps.getLogger().warn('Function "'+o+'" cannot be called on an AWS Lambda segment. Please use a subsegment to record data.')}}():e[i]=function(){});return e.trace_id=vo.Invalid().toString(),e.isClosed=function(){return!0},e.in_progress=!1,e.counter=1,e.notTraced=!0,e.facade=!0,e.reset=function(){this.trace_id=vo.Invalid().toString(),this.id="00000000",delete this.subsegments,this.notTraced=!0},e.resolveLambdaTraceData=function(){var a;let u=(a=globalThis.awslambda)===null||a===void 0?void 0:a.InvokeStore,c=u?.getXRayTraceId(),l=process.env._X_AMZN_TRACE_ID;var d=c??l;d?d!=hs&&(this.reset(),fs.populateTraceData(e,d)&&(hs=d)):(this.reset(),er.contextMissingStrategy.contextMissing("Missing AWS Lambda trace data for X-Ray. Ensure Active Tracing is enabled and no subsegments are created outside the function handler."))},fs.validTraceData(n)&&fs.populateTraceData(e,n)&&(hs=n),e}});var _o=f((sS,th)=>{th.exports={name:"aws-xray-sdk-core",version:"3.12.0",description:"AWS X-Ray SDK for Javascript",author:"Amazon Web Services",contributors:["Sandra McMullen <mcmuls@amazon.com>","William Armiros <armiros@amazon.com>","Moritz Onken <onken@netcubed.de>"],files:["dist/lib/**/*","LICENSE","README.md"],main:"dist/lib/index.js",types:"dist/lib/index.d.ts",engines:{node:">= 14.x"},directories:{test:"test"},"//":"@types/cls-hooked is exposed in API so must be in dependencies, not devDependencies",dependencies:{"@aws-sdk/types":"^3.4.1","@smithy/service-error-classification":"^2.0.4","@types/cls-hooked":"^4.3.3","atomic-batcher":"^1.0.2","cls-hooked":"^4.2.2",semver:"^7.5.3"},devDependencies:{"@aws/lambda-invoke-store":"^0.2.0"},scripts:{prepare:"npm run compile",compile:"tsc && npm run copy-lib && npm run copy-test","copy-lib":"find lib -type f \\( -name '*.d.ts' -o -name '*.json' \\) | xargs -I % ../../scripts/cp-with-structure.sh % dist","copy-test":"find test -name '*.json' | xargs -I % ../../scripts/cp-with-structure.sh % dist",lint:"eslint .","lint:fix":"eslint . --fix",test:"npm run compile && mocha --recursive ./dist/test/ -R spec && tsd && mocha --recursive ./dist/test_async/ -R spec","test-d":"tsd","test-async":"npm run compile && mocha --recursive ./dist/test_async/ -R spec",clean:"rm -rf dist && rm -rf node_modules",testcov:"nyc npm run test",reportcov:"nyc report --reporter=text-lcov > coverage.lcov"},keywords:["amazon","api","aws","core","xray","x-ray","x ray"],license:"Apache-2.0",repository:"https://github.com/aws/aws-xray-sdk-node/tree/master/packages/core",gitHead:"51831b9577e061cea36644a7e19f9cf0cc28fc8a"}});var To=f((nS,yo)=>{"use strict";var gs=require("http"),bo={METADATA_TIMEOUT:1e3,getPluginMetadata:function(r,e){var n=5,i=function(){var o=gs.__request?gs.__request:gs.request,a=o(r,function(u){var c="";u.on("data",function(l){c+=l}),u.on("end",function(){if(this.statusCode===200||this.statusCode===300){try{c=JSON.parse(c)}catch(l){e(l);return}e(null,c)}else n>0&&Math.floor(this.statusCode/100)===5?(n--,setTimeout(i,250)):e(new Error(`Failed to retrieve metadata with options: ${r}`))})});a.on("error",function(u){e(u)}),a.on("timeout",function(){a.abort()}),a.setTimeout(bo.METADATA_TIMEOUT),a.end()};i()}};yo.exports=bo});var Io=f((iS,Co)=>{"use strict";var Ro=To(),Ao=N(),ms=require("http"),rh={getData:function(r){let e="/latest/dynamic/instance-identity/document";function t(s){let n=wo(e,"GET",s?{"X-aws-ec2-metadata-token":s}:{});Ro.getPluginMetadata(n,function(i,o){if(i||!o){Ao.getLogger().error("Error loading EC2 plugin metadata: ",i?i.toString():"Could not retrieve data from IMDS."),r();return}let a={ec2:{instance_id:o.instanceId,availability_zone:o.availabilityZone,instance_size:o.instanceType,ami_id:o.imageId}};r(a)})}sh(function(s){s===null&&Ao.getLogger().debug("EC2Plugin failed to get token from IMDSv2. Falling back to IMDSv1."),t(s)})},originName:"AWS::EC2::Instance"};function sh(r){let e=ms.__request?ms.__request:ms.request,n=wo("/latest/api/token","PUT",{"X-aws-ec2-metadata-token-ttl-seconds":60}),i=e(n,function(o){let a="";o.on("data",function(u){a+=u}),o.on("end",function(){this.statusCode===200||this.statusCode===300?r(a):r(null)})});i.on("error",function(){r(null)}),i.on("timeout",function(){i.abort(),r(null)}),i.setTimeout(Ro.METADATA_TIMEOUT),i.end()}function wo(r,e,t){return e||(e="GET"),t||(t={}),{host:"169.254.169.254",path:r,method:e,headers:t}}Co.exports=rh});var No=f((oS,Lo)=>{"use strict";var nh=require("os"),ih={getData:function(r){r({ecs:{container:nh.hostname()}})},originName:"AWS::ECS::Container"};Lo.exports=ih});var qo=f((aS,Oo)=>{"use strict";var oh=require("fs"),ah=N(),uh="/var/elasticbeanstalk/xray/environment.conf",ch={getData:function(r){oh.readFile(uh,"utf8",function(e,t){if(e)ah.getLogger().error("Error loading Elastic Beanstalk plugin:",e.stack),r();else{var s=JSON.parse(t),n={elastic_beanstalk:{environment:s.environment_name,version_label:s.version_label,deployment_id:s.deployment_id}};r(n)}})},originName:"AWS::ElasticBeanstalk::Environment"};Oo.exports=ch});var xo=f((uS,lh)=>{lh.exports={services:{dynamodb:{operations:{batchGetItem:{request_descriptors:{RequestItems:{get_keys:!0,rename_to:"table_names"}},response_parameters:["ConsumedCapacity"]},batchWriteItem:{request_descriptors:{RequestItems:{get_keys:!0,rename_to:"table_names"}},response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},createTable:{request_parameters:["GlobalSecondaryIndexes","LocalSecondaryIndexes","ProvisionedThroughput","TableName"]},deleteItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},deleteTable:{request_parameters:["TableName"]},describeTable:{request_parameters:["TableName"]},getItem:{request_parameters:["ConsistentRead","ProjectionExpression","TableName"],response_parameters:["ConsumedCapacity"]},listTables:{request_parameters:["ExclusiveStartTableName","Limit"],response_descriptors:{TableNames:{list:!0,get_count:!0,rename_to:"table_count"}}},putItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},query:{request_parameters:["AttributesToGet","ConsistentRead","IndexName","Limit","ProjectionExpression","ScanIndexForward","Select","TableName"],response_parameters:["ConsumedCapacity"]},scan:{request_parameters:["AttributesToGet","ConsistentRead","IndexName","Limit","ProjectionExpression","Segment","Select","TableName","TotalSegments"],response_parameters:["ConsumedCapacity","Count","ScannedCount"]},updateItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},updateTable:{request_parameters:["AttributeDefinitions","GlobalSecondaryIndexUpdates","ProvisionedThroughput","TableName"]}}},sqs:{operations:{addPermission:{request_parameters:["Label","QueueUrl"]},changeMessageVisibility:{request_parameters:["QueueUrl","VisibilityTimeout"]},changeMessageVisibilityBatch:{request_parameters:["QueueUrl"],response_parameters:["Failed"]},createQueue:{request_parameters:["Attributes","QueueName"]},deleteMessage:{request_parameters:["QueueUrl"]},deleteMessageBatch:{request_parameters:["QueueUrl"],response_parameters:["Failed"]},deleteQueue:{request_parameters:["QueueUrl"]},getQueueAttributes:{request_parameters:["QueueUrl"],response_parameters:["Attributes"]},getQueueUrl:{request_parameters:["QueueName","QueueOwnerAWSAccountId"],response_parameters:["QueueUrl"]},listDeadLetterSourceQueues:{request_parameters:["QueueUrl"],response_parameters:["QueueUrls"]},listQueues:{request_parameters:["QueueNamePrefix"],response_descriptors:{QueueUrls:{list:!0,get_count:!0,rename_to:"queue_count"}}},purgeQueue:{request_parameters:["QueueUrl"]},receiveMessage:{request_parameters:["AttributeNames","MaxNumberOfMessages","MessageAttributeNames","QueueUrl","VisibilityTimeout","WaitTimeSeconds"],response_descriptors:{Messages:{list:!0,get_count:!0,rename_to:"message_count"}}},removePermission:{request_parameters:["QueueUrl"]},sendMessage:{request_parameters:["DelaySeconds","QueueUrl"],request_descriptors:{MessageAttributes:{get_keys:!0,rename_to:"message_attribute_names"}},response_parameters:["MessageId"]},sendMessageBatch:{request_parameters:["QueueUrl"],request_descriptors:{Entries:{list:!0,get_count:!0,rename_to:"message_count"}},response_descriptors:{Failed:{list:!0,get_count:!0,rename_to:"failed_count"},Successful:{list:!0,get_count:!0,rename_to:"successful_count"}}},setQueueAttributes:{request_parameters:["QueueUrl"],request_descriptors:{Attributes:{get_keys:!0,rename_to:"attribute_names"}}}}},sns:{operations:{publish:{request_parameters:["TopicArn"]},publishBatch:{request_parameters:["TopicArn"]}}},lambda:{operations:{invoke:{request_parameters:["FunctionName","InvocationType","LogType","Qualifier"],response_parameters:["FunctionError","StatusCode"]},invokeAsync:{request_parameters:["FunctionName"],response_parameters:["Status"]}}},s3:{operations:{abortMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},completeMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},copyObject:{request_parameters:["CopySource","Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},createBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},createMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObjects:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAccelerateConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAcl:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLifecycleConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLocation:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLogging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketNotification:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketNotificationConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketRequestPayment:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketVersioning:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectAcl:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectTorrent:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},headBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},headObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketAnalyticsConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketInventoryConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketMetricsConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listMultipartUploads:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjectVersions:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjects:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjectsV2:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listParts:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAccelerateConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAcl:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLifecycleConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLogging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketNotification:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketNotificationConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketRequestPayment:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketVersioning:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObject:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObjectAcl:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},restoreObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},uploadPart:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},uploadPartCopy:{request_parameters:["CopySource","Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}}}},sagemakerruntime:{operations:{invokeEndpoint:{request_parameters:["EndpointName"]}}}}}});var Fo=f((cS,Po)=>{"use strict";var $o=require("fs"),Oe=N(),dh=xo(),tr={REQ_DESC:"request_descriptors",REQ_PARAMS:"request_parameters",RES_DESC:"response_descriptors",RES_PARAMS:"response_parameters"};function sr(r){this.init(r)}sr.prototype.init=function(e){e?typeof e=="string"?(Oe.getLogger().info("Using custom AWS whitelist file: "+e),this.services=rr(JSON.parse($o.readFileSync(e,"utf8")))):(Oe.getLogger().info("Using custom AWS whitelist source."),this.services=rr(e)):this.services=dh.services};sr.prototype.append=function(e){var t={};typeof e=="string"?(Oe.getLogger().info("Appending AWS whitelist with custom file: "+e),t=rr(JSON.parse($o.readFileSync(e,"utf8")))):(Oe.getLogger().info("Appending AWS whitelist with a custom source."),t=rr(e));for(var s in t)this.services[s]=t[s]};sr.prototype.capture=function(e,t){var s=t.request.operation,n=this.services[e]!==void 0?this.services[e].operations[s]:null;if(n===null){Oe.getLogger().debug('Call "'+e+"."+s+'" is not whitelisted for additional data capturing. Ignoring.');return}var i={};for(var o in n){var a=n[o];o===tr.REQ_PARAMS?Mo(a,t.request.params,i):o===tr.REQ_DESC?Do(a,t.request.params,i):o===tr.RES_PARAMS?t.data&&Mo(a,t.data,i):o===tr.RES_DESC?t.data&&Do(a,t.data,i):Oe.getLogger().error('Unknown parameter type "'+o+'". Must be "request_descriptors", "response_descriptors", "request_parameters" or "response_parameters".')}return i};function Mo(r,e,t){r.forEach(function(s){if(typeof e[s]<"u"){var n=ko(s);this[n]=e[s]}},t)}function Do(r,e,t){for(var s in r){var n=r[s];if(typeof e[s]<"u"){var i;if(n.list&&n.get_count?i=e[s]?e[s].length:0:i=n.get_keys===!0?Object.keys(e[s]):e[s],typeof n.rename_to=="string")t[n.rename_to]=i;else{var o=ko(s);t[o]=i}}}}function ko(r){return r==="IPAddress"?"ip_address":r.split(/(?=[A-Z])/).join("_").toLowerCase()}function rr(r){var e=r;if(e.services===void 0)throw new Error('Document formatting is incorrect. Expecting "services" param.');return e.services}Po.exports=sr});var ot=f((lS,nr)=>{"use strict";var Bo=Fo(),vs=new Bo;function Es(r,e){this.init(r,e)}Es.prototype.init=function(e,t){this.operation=ph(e.request.operation)||"",e&&e.request&&e.request.httpRequest&&e.request.httpRequest.region&&(this.region=e.request.httpRequest.region),e&&e.requestId&&(this.request_id=e.requestId),this.retries=e.retryCount||0,e.extendedRequestId&&t&&t.toLowerCase()==="s3"&&(this.id_2=e.extendedRequestId),t&&this.addData(vs.capture(t.toLowerCase(),e))};Es.prototype.addData=function(e){for(var t in e)this[t]=e[t]};var fh=function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local whitelist file, or supply a whitelist source object.");vs=new Bo(e)},hh=function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local whitelist file, or supply a whitelist source object.");vs.append(e)};function ph(r){if(r)return r.charAt(0).toUpperCase()+r.slice(1)}nr.exports=Es;nr.exports.appendAWSWhitelist=hh;nr.exports.setAWSWhitelist=fh});var or=f((dS,ir)=>{"use strict";var _e=he(),at=N(),Uo=function(e,t,s){Ss(e,t);var n,i,o=_e.resolveSegment(s);if(!o)return at.getLogger().warn("Failed to capture function."),t();n=o.addNewSubsegment(e),i=jo(t,n);try{let a=i(n);return n.close(),a}catch(a){throw n.close(a),a}},gh=function(e,t,s){Ss(e,t);var n,i,o=_e.resolveSegment(s);if(!o)return at.getLogger().warn("Failed to capture async function."),t();n=o.addNewSubsegment(e),i=jo(t,n);try{return i(n)}catch(a){throw n.close(a),a}},mh=function(e,t,s){Ss(e,t);var n=_e.resolveSegment(s);return n?(n.incrementCounter(),function(){var i=_e.resolveSegment(s),o=Array.prototype.slice.call(arguments);Uo(e,t.bind.apply(t,[null].concat(o)),i),n.decrementCounter()}.bind(this)):(at.getLogger().warn("Failed to capture callback function."),t)};function jo(r,e){var t;if(_e.isAutomaticMode()){var s=_e.getNamespace(),n=function(){var i;return s.run(function(){_e.setSegment(e),i=r(e)}),i};t=n}else t=r;return t}function Ss(r,e){var t;if(!r||typeof r!="string")throw t='Param "name" must be a non-empty string.',at.getLogger().error(t),new Error(t);if(typeof e!="function")throw t='Param "fcn" must be a function.',at.getLogger().error(t),new Error(t)}ir.exports.captureFunc=Uo;ir.exports.captureAsyncFunc=gh;ir.exports.captureCallbackFunc=mh});var ut=f((fS,Wo)=>{"use strict";var vh="2.0.0",Eh=Number.MAX_SAFE_INTEGER||9007199254740991,Sh=16,_h=250,bh=["major","premajor","minor","preminor","patch","prepatch","prerelease"];Wo.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:Sh,MAX_SAFE_BUILD_LENGTH:_h,MAX_SAFE_INTEGER:Eh,RELEASE_TYPES:bh,SEMVER_SPEC_VERSION:vh,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var ct=f((hS,Go)=>{"use strict";var yh=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{};Go.exports=yh});var qe=f((Y,Vo)=>{"use strict";var{MAX_SAFE_COMPONENT_LENGTH:_s,MAX_SAFE_BUILD_LENGTH:Th,MAX_LENGTH:Ah}=ut(),Rh=ct();Y=Vo.exports={};var wh=Y.re=[],Ch=Y.safeRe=[],p=Y.src=[],Ih=Y.safeSrc=[],g=Y.t={},Lh=0,bs="[a-zA-Z0-9-]",Nh=[["\\s",1],["\\d",Ah],[bs,Th]],Oh=r=>{for(let[e,t]of Nh)r=r.split(`${e}*`).join(`${e}{0,${t}}`).split(`${e}+`).join(`${e}{1,${t}}`);return r},v=(r,e,t)=>{let s=Oh(e),n=Lh++;Rh(r,n,e),g[r]=n,p[n]=e,Ih[n]=s,wh[n]=new RegExp(e,t?"g":void 0),Ch[n]=new RegExp(s,t?"g":void 0)};v("NUMERICIDENTIFIER","0|[1-9]\\d*");v("NUMERICIDENTIFIERLOOSE","\\d+");v("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${bs}*`);v("MAINVERSION",`(${p[g.NUMERICIDENTIFIER]})\\.(${p[g.NUMERICIDENTIFIER]})\\.(${p[g.NUMERICIDENTIFIER]})`);v("MAINVERSIONLOOSE",`(${p[g.NUMERICIDENTIFIERLOOSE]})\\.(${p[g.NUMERICIDENTIFIERLOOSE]})\\.(${p[g.NUMERICIDENTIFIERLOOSE]})`);v("PRERELEASEIDENTIFIER",`(?:${p[g.NONNUMERICIDENTIFIER]}|${p[g.NUMERICIDENTIFIER]})`);v("PRERELEASEIDENTIFIERLOOSE",`(?:${p[g.NONNUMERICIDENTIFIER]}|${p[g.NUMERICIDENTIFIERLOOSE]})`);v("PRERELEASE",`(?:-(${p[g.PRERELEASEIDENTIFIER]}(?:\\.${p[g.PRERELEASEIDENTIFIER]})*))`);v("PRERELEASELOOSE",`(?:-?(${p[g.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${p[g.PRERELEASEIDENTIFIERLOOSE]})*))`);v("BUILDIDENTIFIER",`${bs}+`);v("BUILD",`(?:\\+(${p[g.BUILDIDENTIFIER]}(?:\\.${p[g.BUILDIDENTIFIER]})*))`);v("FULLPLAIN",`v?${p[g.MAINVERSION]}${p[g.PRERELEASE]}?${p[g.BUILD]}?`);v("FULL",`^${p[g.FULLPLAIN]}$`);v("LOOSEPLAIN",`[v=\\s]*${p[g.MAINVERSIONLOOSE]}${p[g.PRERELEASELOOSE]}?${p[g.BUILD]}?`);v("LOOSE",`^${p[g.LOOSEPLAIN]}$`);v("GTLT","((?:<|>)?=?)");v("XRANGEIDENTIFIERLOOSE",`${p[g.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);v("XRANGEIDENTIFIER",`${p[g.NUMERICIDENTIFIER]}|x|X|\\*`);v("XRANGEPLAIN",`[v=\\s]*(${p[g.XRANGEIDENTIFIER]})(?:\\.(${p[g.XRANGEIDENTIFIER]})(?:\\.(${p[g.XRANGEIDENTIFIER]})(?:${p[g.PRERELEASE]})?${p[g.BUILD]}?)?)?`);v("XRANGEPLAINLOOSE",`[v=\\s]*(${p[g.XRANGEIDENTIFIERLOOSE]})(?:\\.(${p[g.XRANGEIDENTIFIERLOOSE]})(?:\\.(${p[g.XRANGEIDENTIFIERLOOSE]})(?:${p[g.PRERELEASELOOSE]})?${p[g.BUILD]}?)?)?`);v("XRANGE",`^${p[g.GTLT]}\\s*${p[g.XRANGEPLAIN]}$`);v("XRANGELOOSE",`^${p[g.GTLT]}\\s*${p[g.XRANGEPLAINLOOSE]}$`);v("COERCEPLAIN",`(^|[^\\d])(\\d{1,${_s}})(?:\\.(\\d{1,${_s}}))?(?:\\.(\\d{1,${_s}}))?`);v("COERCE",`${p[g.COERCEPLAIN]}(?:$|[^\\d])`);v("COERCEFULL",p[g.COERCEPLAIN]+`(?:${p[g.PRERELEASE]})?(?:${p[g.BUILD]})?(?:$|[^\\d])`);v("COERCERTL",p[g.COERCE],!0);v("COERCERTLFULL",p[g.COERCEFULL],!0);v("LONETILDE","(?:~>?)");v("TILDETRIM",`(\\s*)${p[g.LONETILDE]}\\s+`,!0);Y.tildeTrimReplace="$1~";v("TILDE",`^${p[g.LONETILDE]}${p[g.XRANGEPLAIN]}$`);v("TILDELOOSE",`^${p[g.LONETILDE]}${p[g.XRANGEPLAINLOOSE]}$`);v("LONECARET","(?:\\^)");v("CARETTRIM",`(\\s*)${p[g.LONECARET]}\\s+`,!0);Y.caretTrimReplace="$1^";v("CARET",`^${p[g.LONECARET]}${p[g.XRANGEPLAIN]}$`);v("CARETLOOSE",`^${p[g.LONECARET]}${p[g.XRANGEPLAINLOOSE]}$`);v("COMPARATORLOOSE",`^${p[g.GTLT]}\\s*(${p[g.LOOSEPLAIN]})$|^$`);v("COMPARATOR",`^${p[g.GTLT]}\\s*(${p[g.FULLPLAIN]})$|^$`);v("COMPARATORTRIM",`(\\s*)${p[g.GTLT]}\\s*(${p[g.LOOSEPLAIN]}|${p[g.XRANGEPLAIN]})`,!0);Y.comparatorTrimReplace="$1$2$3";v("HYPHENRANGE",`^\\s*(${p[g.XRANGEPLAIN]})\\s+-\\s+(${p[g.XRANGEPLAIN]})\\s*$`);v("HYPHENRANGELOOSE",`^\\s*(${p[g.XRANGEPLAINLOOSE]})\\s+-\\s+(${p[g.XRANGEPLAINLOOSE]})\\s*$`);v("STAR","(<|>)?=?\\s*\\*");v("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");v("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var ar=f((pS,Xo)=>{"use strict";var qh=Object.freeze({loose:!0}),xh=Object.freeze({}),Mh=r=>r?typeof r!="object"?qh:r:xh;Xo.exports=Mh});var ys=f((gS,zo)=>{"use strict";var Ko=/^[0-9]+$/,Ho=(r,e)=>{if(typeof r=="number"&&typeof e=="number")return r===e?0:r<e?-1:1;let t=Ko.test(r),s=Ko.test(e);return t&&s&&(r=+r,e=+e),r===e?0:t&&!s?-1:s&&!t?1:r<e?-1:1},Dh=(r,e)=>Ho(e,r);zo.exports={compareIdentifiers:Ho,rcompareIdentifiers:Dh}});var P=f((mS,Qo)=>{"use strict";var ur=ct(),{MAX_LENGTH:Yo,MAX_SAFE_INTEGER:cr}=ut(),{safeRe:lr,t:dr}=qe(),$h=ar(),{compareIdentifiers:Ts}=ys(),As=class r{constructor(e,t){if(t=$h(t),e instanceof r){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>Yo)throw new TypeError(`version is longer than ${Yo} characters`);ur("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let s=e.trim().match(t.loose?lr[dr.LOOSE]:lr[dr.FULL]);if(!s)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+s[1],this.minor=+s[2],this.patch=+s[3],this.major>cr||this.major<0)throw new TypeError("Invalid major version");if(this.minor>cr||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>cr||this.patch<0)throw new TypeError("Invalid patch version");s[4]?this.prerelease=s[4].split(".").map(n=>{if(/^[0-9]+$/.test(n)){let i=+n;if(i>=0&&i<cr)return i}return n}):this.prerelease=[],this.build=s[5]?s[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(ur("SemVer.compare",this.version,this.options,e),!(e instanceof r)){if(typeof e=="string"&&e===this.version)return 0;e=new r(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof r||(e=new r(e,this.options)),this.major<e.major?-1:this.major>e.major?1:this.minor<e.minor?-1:this.minor>e.minor?1:this.patch<e.patch?-1:this.patch>e.patch?1:0}comparePre(e){if(e instanceof r||(e=new r(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let s=this.prerelease[t],n=e.prerelease[t];if(ur("prerelease compare",t,s,n),s===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(s===void 0)return-1;if(s===n)continue;return Ts(s,n)}while(++t)}compareBuild(e){e instanceof r||(e=new r(e,this.options));let t=0;do{let s=this.build[t],n=e.build[t];if(ur("build compare",t,s,n),s===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(s===void 0)return-1;if(s===n)continue;return Ts(s,n)}while(++t)}inc(e,t,s){if(e.startsWith("pre")){if(!t&&s===!1)throw new Error("invalid increment argument: identifier is empty");if(t){let n=`-${t}`.match(this.options.loose?lr[dr.PRERELEASELOOSE]:lr[dr.PRERELEASE]);if(!n||n[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,s);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,s);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,s),this.inc("pre",t,s);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,s),this.inc("pre",t,s);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let n=Number(s)?1:0;if(this.prerelease.length===0)this.prerelease=[n];else{let i=this.prerelease.length;for(;--i>=0;)typeof this.prerelease[i]=="number"&&(this.prerelease[i]++,i=-2);if(i===-1){if(t===this.prerelease.join(".")&&s===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(n)}}if(t){let i=[t,n];s===!1&&(i=[t]),Ts(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=i):this.prerelease=i}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};Qo.exports=As});var be=f((vS,Zo)=>{"use strict";var Jo=P(),kh=(r,e,t=!1)=>{if(r instanceof Jo)return r;try{return new Jo(r,e)}catch(s){if(!t)return null;throw s}};Zo.exports=kh});var ta=f((ES,ea)=>{"use strict";var Ph=be(),Fh=(r,e)=>{let t=Ph(r,e);return t?t.version:null};ea.exports=Fh});var sa=f((SS,ra)=>{"use strict";var Bh=be(),Uh=(r,e)=>{let t=Bh(r.trim().replace(/^[=v]+/,""),e);return t?t.version:null};ra.exports=Uh});var oa=f((_S,ia)=>{"use strict";var na=P(),jh=(r,e,t,s,n)=>{typeof t=="string"&&(n=s,s=t,t=void 0);try{return new na(r instanceof na?r.version:r,t).inc(e,s,n).version}catch{return null}};ia.exports=jh});var ca=f((bS,ua)=>{"use strict";var aa=be(),Wh=(r,e)=>{let t=aa(r,null,!0),s=aa(e,null,!0),n=t.compare(s);if(n===0)return null;let i=n>0,o=i?t:s,a=i?s:t,u=!!o.prerelease.length;if(!!a.prerelease.length&&!u){if(!a.patch&&!a.minor)return"major";if(a.compareMain(o)===0)return a.minor&&!a.patch?"minor":"patch"}let l=u?"pre":"";return t.major!==s.major?l+"major":t.minor!==s.minor?l+"minor":t.patch!==s.patch?l+"patch":"prerelease"};ua.exports=Wh});var da=f((yS,la)=>{"use strict";var Gh=P(),Vh=(r,e)=>new Gh(r,e).major;la.exports=Vh});var ha=f((TS,fa)=>{"use strict";var Xh=P(),Kh=(r,e)=>new Xh(r,e).minor;fa.exports=Kh});var ga=f((AS,pa)=>{"use strict";var Hh=P(),zh=(r,e)=>new Hh(r,e).patch;pa.exports=zh});var va=f((RS,ma)=>{"use strict";var Yh=be(),Qh=(r,e)=>{let t=Yh(r,e);return t&&t.prerelease.length?t.prerelease:null};ma.exports=Qh});var V=f((wS,Sa)=>{"use strict";var Ea=P(),Jh=(r,e,t)=>new Ea(r,t).compare(new Ea(e,t));Sa.exports=Jh});var ba=f((CS,_a)=>{"use strict";var Zh=V(),ep=(r,e,t)=>Zh(e,r,t);_a.exports=ep});var Ta=f((IS,ya)=>{"use strict";var tp=V(),rp=(r,e)=>tp(r,e,!0);ya.exports=rp});var fr=f((LS,Ra)=>{"use strict";var Aa=P(),sp=(r,e,t)=>{let s=new Aa(r,t),n=new Aa(e,t);return s.compare(n)||s.compareBuild(n)};Ra.exports=sp});var Ca=f((NS,wa)=>{"use strict";var np=fr(),ip=(r,e)=>r.sort((t,s)=>np(t,s,e));wa.exports=ip});var La=f((OS,Ia)=>{"use strict";var op=fr(),ap=(r,e)=>r.sort((t,s)=>op(s,t,e));Ia.exports=ap});var lt=f((qS,Na)=>{"use strict";var up=V(),cp=(r,e,t)=>up(r,e,t)>0;Na.exports=cp});var hr=f((xS,Oa)=>{"use strict";var lp=V(),dp=(r,e,t)=>lp(r,e,t)<0;Oa.exports=dp});var Rs=f((MS,qa)=>{"use strict";var fp=V(),hp=(r,e,t)=>fp(r,e,t)===0;qa.exports=hp});var ws=f((DS,xa)=>{"use strict";var pp=V(),gp=(r,e,t)=>pp(r,e,t)!==0;xa.exports=gp});var pr=f(($S,Ma)=>{"use strict";var mp=V(),vp=(r,e,t)=>mp(r,e,t)>=0;Ma.exports=vp});var gr=f((kS,Da)=>{"use strict";var Ep=V(),Sp=(r,e,t)=>Ep(r,e,t)<=0;Da.exports=Sp});var Cs=f((PS,$a)=>{"use strict";var _p=Rs(),bp=ws(),yp=lt(),Tp=pr(),Ap=hr(),Rp=gr(),wp=(r,e,t,s)=>{switch(e){case"===":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r===t;case"!==":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r!==t;case"":case"=":case"==":return _p(r,t,s);case"!=":return bp(r,t,s);case">":return yp(r,t,s);case">=":return Tp(r,t,s);case"<":return Ap(r,t,s);case"<=":return Rp(r,t,s);default:throw new TypeError(`Invalid operator: ${e}`)}};$a.exports=wp});var Pa=f((FS,ka)=>{"use strict";var Cp=P(),Ip=be(),{safeRe:mr,t:vr}=qe(),Lp=(r,e)=>{if(r instanceof Cp)return r;if(typeof r=="number"&&(r=String(r)),typeof r!="string")return null;e=e||{};let t=null;if(!e.rtl)t=r.match(e.includePrerelease?mr[vr.COERCEFULL]:mr[vr.COERCE]);else{let u=e.includePrerelease?mr[vr.COERCERTLFULL]:mr[vr.COERCERTL],c;for(;(c=u.exec(r))&&(!t||t.index+t[0].length!==r.length);)(!t||c.index+c[0].length!==t.index+t[0].length)&&(t=c),u.lastIndex=c.index+c[1].length+c[2].length;u.lastIndex=-1}if(t===null)return null;let s=t[2],n=t[3]||"0",i=t[4]||"0",o=e.includePrerelease&&t[5]?`-${t[5]}`:"",a=e.includePrerelease&&t[6]?`+${t[6]}`:"";return Ip(`${s}.${n}.${i}${o}${a}`,e)};ka.exports=Lp});var Ba=f((BS,Fa)=>{"use strict";var Is=class{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(t!==void 0)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&t!==void 0){if(this.map.size>=this.max){let n=this.map.keys().next().value;this.delete(n)}this.map.set(e,t)}return this}};Fa.exports=Is});var X=f((US,Ga)=>{"use strict";var Np=/\s+/g,Ls=class r{constructor(e,t){if(t=qp(t),e instanceof r)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new r(e.raw,t);if(e instanceof Ns)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(Np," "),this.set=this.raw.split("||").map(s=>this.parseRange(s.trim())).filter(s=>s.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let s=this.set[0];if(this.set=this.set.filter(n=>!ja(n[0])),this.set.length===0)this.set=[s];else if(this.set.length>1){for(let n of this.set)if(n.length===1&&Fp(n[0])){this.set=[n];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let s=0;s<t.length;s++)s>0&&(this.formatted+=" "),this.formatted+=t[s].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let s=((this.options.includePrerelease&&kp)|(this.options.loose&&Pp))+":"+e,n=Ua.get(s);if(n)return n;let i=this.options.loose,o=i?U[F.HYPHENRANGELOOSE]:U[F.HYPHENRANGE];e=e.replace(o,zp(this.options.includePrerelease)),w("hyphen replace",e),e=e.replace(U[F.COMPARATORTRIM],Mp),w("comparator trim",e),e=e.replace(U[F.TILDETRIM],Dp),w("tilde trim",e),e=e.replace(U[F.CARETTRIM],$p),w("caret trim",e);let a=e.split(" ").map(d=>Bp(d,this.options)).join(" ").split(/\s+/).map(d=>Hp(d,this.options));i&&(a=a.filter(d=>(w("loose invalid filter",d,this.options),!!d.match(U[F.COMPARATORLOOSE])))),w("range list",a);let u=new Map,c=a.map(d=>new Ns(d,this.options));for(let d of c){if(ja(d))return[d];u.set(d.value,d)}u.size>1&&u.has("")&&u.delete("");let l=[...u.values()];return Ua.set(s,l),l}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Range is required");return this.set.some(s=>Wa(s,t)&&e.set.some(n=>Wa(n,t)&&s.every(i=>n.every(o=>i.intersects(o,t)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new xp(e,this.options)}catch{return!1}for(let t=0;t<this.set.length;t++)if(Yp(this.set[t],e,this.options))return!0;return!1}};Ga.exports=Ls;var Op=Ba(),Ua=new Op,qp=ar(),Ns=dt(),w=ct(),xp=P(),{safeRe:U,t:F,comparatorTrimReplace:Mp,tildeTrimReplace:Dp,caretTrimReplace:$p}=qe(),{FLAG_INCLUDE_PRERELEASE:kp,FLAG_LOOSE:Pp}=ut(),ja=r=>r.value==="<0.0.0-0",Fp=r=>r.value==="",Wa=(r,e)=>{let t=!0,s=r.slice(),n=s.pop();for(;t&&s.length;)t=s.every(i=>n.intersects(i,e)),n=s.pop();return t},Bp=(r,e)=>(r=r.replace(U[F.BUILD],""),w("comp",r,e),r=Wp(r,e),w("caret",r),r=Up(r,e),w("tildes",r),r=Vp(r,e),w("xrange",r),r=Kp(r,e),w("stars",r),r),j=r=>!r||r.toLowerCase()==="x"||r==="*",Up=(r,e)=>r.trim().split(/\s+/).map(t=>jp(t,e)).join(" "),jp=(r,e)=>{let t=e.loose?U[F.TILDELOOSE]:U[F.TILDE];return r.replace(t,(s,n,i,o,a)=>{w("tilde",r,s,n,i,o,a);let u;return j(n)?u="":j(i)?u=`>=${n}.0.0 <${+n+1}.0.0-0`:j(o)?u=`>=${n}.${i}.0 <${n}.${+i+1}.0-0`:a?(w("replaceTilde pr",a),u=`>=${n}.${i}.${o}-${a} <${n}.${+i+1}.0-0`):u=`>=${n}.${i}.${o} <${n}.${+i+1}.0-0`,w("tilde return",u),u})},Wp=(r,e)=>r.trim().split(/\s+/).map(t=>Gp(t,e)).join(" "),Gp=(r,e)=>{w("caret",r,e);let t=e.loose?U[F.CARETLOOSE]:U[F.CARET],s=e.includePrerelease?"-0":"";return r.replace(t,(n,i,o,a,u)=>{w("caret",r,n,i,o,a,u);let c;return j(i)?c="":j(o)?c=`>=${i}.0.0${s} <${+i+1}.0.0-0`:j(a)?i==="0"?c=`>=${i}.${o}.0${s} <${i}.${+o+1}.0-0`:c=`>=${i}.${o}.0${s} <${+i+1}.0.0-0`:u?(w("replaceCaret pr",u),i==="0"?o==="0"?c=`>=${i}.${o}.${a}-${u} <${i}.${o}.${+a+1}-0`:c=`>=${i}.${o}.${a}-${u} <${i}.${+o+1}.0-0`:c=`>=${i}.${o}.${a}-${u} <${+i+1}.0.0-0`):(w("no pr"),i==="0"?o==="0"?c=`>=${i}.${o}.${a}${s} <${i}.${o}.${+a+1}-0`:c=`>=${i}.${o}.${a}${s} <${i}.${+o+1}.0-0`:c=`>=${i}.${o}.${a} <${+i+1}.0.0-0`),w("caret return",c),c})},Vp=(r,e)=>(w("replaceXRanges",r,e),r.split(/\s+/).map(t=>Xp(t,e)).join(" ")),Xp=(r,e)=>{r=r.trim();let t=e.loose?U[F.XRANGELOOSE]:U[F.XRANGE];return r.replace(t,(s,n,i,o,a,u)=>{w("xRange",r,s,n,i,o,a,u);let c=j(i),l=c||j(o),d=l||j(a),m=d;return n==="="&&m&&(n=""),u=e.includePrerelease?"-0":"",c?n===">"||n==="<"?s="<0.0.0-0":s="*":n&&m?(l&&(o=0),a=0,n===">"?(n=">=",l?(i=+i+1,o=0,a=0):(o=+o+1,a=0)):n==="<="&&(n="<",l?i=+i+1:o=+o+1),n==="<"&&(u="-0"),s=`${n+i}.${o}.${a}${u}`):l?s=`>=${i}.0.0${u} <${+i+1}.0.0-0`:d&&(s=`>=${i}.${o}.0${u} <${i}.${+o+1}.0-0`),w("xRange return",s),s})},Kp=(r,e)=>(w("replaceStars",r,e),r.trim().replace(U[F.STAR],"")),Hp=(r,e)=>(w("replaceGTE0",r,e),r.trim().replace(U[e.includePrerelease?F.GTE0PRE:F.GTE0],"")),zp=r=>(e,t,s,n,i,o,a,u,c,l,d,m)=>(j(s)?t="":j(n)?t=`>=${s}.0.0${r?"-0":""}`:j(i)?t=`>=${s}.${n}.0${r?"-0":""}`:o?t=`>=${t}`:t=`>=${t}${r?"-0":""}`,j(c)?u="":j(l)?u=`<${+c+1}.0.0-0`:j(d)?u=`<${c}.${+l+1}.0-0`:m?u=`<=${c}.${l}.${d}-${m}`:r?u=`<${c}.${l}.${+d+1}-0`:u=`<=${u}`,`${t} ${u}`.trim()),Yp=(r,e,t)=>{for(let s=0;s<r.length;s++)if(!r[s].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(let s=0;s<r.length;s++)if(w(r[s].semver),r[s].semver!==Ns.ANY&&r[s].semver.prerelease.length>0){let n=r[s].semver;if(n.major===e.major&&n.minor===e.minor&&n.patch===e.patch)return!0}return!1}return!0}});var dt=f((jS,Ya)=>{"use strict";var ft=Symbol("SemVer ANY"),xs=class r{static get ANY(){return ft}constructor(e,t){if(t=Va(t),e instanceof r){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),qs("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===ft?this.value="":this.value=this.operator+this.semver.version,qs("comp",this)}parse(e){let t=this.options.loose?Xa[Ka.COMPARATORLOOSE]:Xa[Ka.COMPARATOR],s=e.match(t);if(!s)throw new TypeError(`Invalid comparator: ${e}`);this.operator=s[1]!==void 0?s[1]:"",this.operator==="="&&(this.operator=""),s[2]?this.semver=new Ha(s[2],this.options.loose):this.semver=ft}toString(){return this.value}test(e){if(qs("Comparator.test",e,this.options.loose),this.semver===ft||e===ft)return!0;if(typeof e=="string")try{e=new Ha(e,this.options)}catch{return!1}return Os(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new za(e.value,t).test(this.value):e.operator===""?e.value===""?!0:new za(this.value,t).test(e.semver):(t=Va(t),t.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||Os(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||Os(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};Ya.exports=xs;var Va=ar(),{safeRe:Xa,t:Ka}=qe(),Os=Cs(),qs=ct(),Ha=P(),za=X()});var ht=f((WS,Qa)=>{"use strict";var Qp=X(),Jp=(r,e,t)=>{try{e=new Qp(e,t)}catch{return!1}return e.test(r)};Qa.exports=Jp});var Za=f((GS,Ja)=>{"use strict";var Zp=X(),eg=(r,e)=>new Zp(r,e).set.map(t=>t.map(s=>s.value).join(" ").trim().split(" "));Ja.exports=eg});var tu=f((VS,eu)=>{"use strict";var tg=P(),rg=X(),sg=(r,e,t)=>{let s=null,n=null,i=null;try{i=new rg(e,t)}catch{return null}return r.forEach(o=>{i.test(o)&&(!s||n.compare(o)===-1)&&(s=o,n=new tg(s,t))}),s};eu.exports=sg});var su=f((XS,ru)=>{"use strict";var ng=P(),ig=X(),og=(r,e,t)=>{let s=null,n=null,i=null;try{i=new ig(e,t)}catch{return null}return r.forEach(o=>{i.test(o)&&(!s||n.compare(o)===1)&&(s=o,n=new ng(s,t))}),s};ru.exports=og});var ou=f((KS,iu)=>{"use strict";var Ms=P(),ag=X(),nu=lt(),ug=(r,e)=>{r=new ag(r,e);let t=new Ms("0.0.0");if(r.test(t)||(t=new Ms("0.0.0-0"),r.test(t)))return t;t=null;for(let s=0;s<r.set.length;++s){let n=r.set[s],i=null;n.forEach(o=>{let a=new Ms(o.semver.version);switch(o.operator){case">":a.prerelease.length===0?a.patch++:a.prerelease.push(0),a.raw=a.format();case"":case">=":(!i||nu(a,i))&&(i=a);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${o.operator}`)}}),i&&(!t||nu(t,i))&&(t=i)}return t&&r.test(t)?t:null};iu.exports=ug});var uu=f((HS,au)=>{"use strict";var cg=X(),lg=(r,e)=>{try{return new cg(r,e).range||"*"}catch{return null}};au.exports=lg});var Er=f((zS,fu)=>{"use strict";var dg=P(),du=dt(),{ANY:fg}=du,hg=X(),pg=ht(),cu=lt(),lu=hr(),gg=gr(),mg=pr(),vg=(r,e,t,s)=>{r=new dg(r,s),e=new hg(e,s);let n,i,o,a,u;switch(t){case">":n=cu,i=gg,o=lu,a=">",u=">=";break;case"<":n=lu,i=mg,o=cu,a="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(pg(r,e,s))return!1;for(let c=0;c<e.set.length;++c){let l=e.set[c],d=null,m=null;if(l.forEach(h=>{h.semver===fg&&(h=new du(">=0.0.0")),d=d||h,m=m||h,n(h.semver,d.semver,s)?d=h:o(h.semver,m.semver,s)&&(m=h)}),d.operator===a||d.operator===u||(!m.operator||m.operator===a)&&i(r,m.semver))return!1;if(m.operator===u&&o(r,m.semver))return!1}return!0};fu.exports=vg});var pu=f((YS,hu)=>{"use strict";var Eg=Er(),Sg=(r,e,t)=>Eg(r,e,">",t);hu.exports=Sg});var mu=f((QS,gu)=>{"use strict";var _g=Er(),bg=(r,e,t)=>_g(r,e,"<",t);gu.exports=bg});var Su=f((JS,Eu)=>{"use strict";var vu=X(),yg=(r,e,t)=>(r=new vu(r,t),e=new vu(e,t),r.intersects(e,t));Eu.exports=yg});var bu=f((ZS,_u)=>{"use strict";var Tg=ht(),Ag=V();_u.exports=(r,e,t)=>{let s=[],n=null,i=null,o=r.sort((l,d)=>Ag(l,d,t));for(let l of o)Tg(l,e,t)?(i=l,n||(n=l)):(i&&s.push([n,i]),i=null,n=null);n&&s.push([n,null]);let a=[];for(let[l,d]of s)l===d?a.push(l):!d&&l===o[0]?a.push("*"):d?l===o[0]?a.push(`<=${d}`):a.push(`${l} - ${d}`):a.push(`>=${l}`);let u=a.join(" || "),c=typeof e.raw=="string"?e.raw:String(e);return u.length<c.length?u:e}});var Cu=f((e_,wu)=>{"use strict";var yu=X(),$s=dt(),{ANY:Ds}=$s,pt=ht(),ks=V(),Rg=(r,e,t={})=>{if(r===e)return!0;r=new yu(r,t),e=new yu(e,t);let s=!1;e:for(let n of r.set){for(let i of e.set){let o=Cg(n,i,t);if(s=s||o!==null,o)continue e}if(s)return!1}return!0},wg=[new $s(">=0.0.0-0")],Tu=[new $s(">=0.0.0")],Cg=(r,e,t)=>{if(r===e)return!0;if(r.length===1&&r[0].semver===Ds){if(e.length===1&&e[0].semver===Ds)return!0;t.includePrerelease?r=wg:r=Tu}if(e.length===1&&e[0].semver===Ds){if(t.includePrerelease)return!0;e=Tu}let s=new Set,n,i;for(let h of r)h.operator===">"||h.operator===">="?n=Au(n,h,t):h.operator==="<"||h.operator==="<="?i=Ru(i,h,t):s.add(h.semver);if(s.size>1)return null;let o;if(n&&i){if(o=ks(n.semver,i.semver,t),o>0)return null;if(o===0&&(n.operator!==">="||i.operator!=="<="))return null}for(let h of s){if(n&&!pt(h,String(n),t)||i&&!pt(h,String(i),t))return null;for(let b of e)if(!pt(h,String(b),t))return!1;return!0}let a,u,c,l,d=i&&!t.includePrerelease&&i.semver.prerelease.length?i.semver:!1,m=n&&!t.includePrerelease&&n.semver.prerelease.length?n.semver:!1;d&&d.prerelease.length===1&&i.operator==="<"&&d.prerelease[0]===0&&(d=!1);for(let h of e){if(l=l||h.operator===">"||h.operator===">=",c=c||h.operator==="<"||h.operator==="<=",n){if(m&&h.semver.prerelease&&h.semver.prerelease.length&&h.semver.major===m.major&&h.semver.minor===m.minor&&h.semver.patch===m.patch&&(m=!1),h.operator===">"||h.operator===">="){if(a=Au(n,h,t),a===h&&a!==n)return!1}else if(n.operator===">="&&!pt(n.semver,String(h),t))return!1}if(i){if(d&&h.semver.prerelease&&h.semver.prerelease.length&&h.semver.major===d.major&&h.semver.minor===d.minor&&h.semver.patch===d.patch&&(d=!1),h.operator==="<"||h.operator==="<="){if(u=Ru(i,h,t),u===h&&u!==i)return!1}else if(i.operator==="<="&&!pt(i.semver,String(h),t))return!1}if(!h.operator&&(i||n)&&o!==0)return!1}return!(n&&c&&!i&&o!==0||i&&l&&!n&&o!==0||m||d)},Au=(r,e,t)=>{if(!r)return e;let s=ks(r.semver,e.semver,t);return s>0?r:s<0||e.operator===">"&&r.operator===">="?e:r},Ru=(r,e,t)=>{if(!r)return e;let s=ks(r.semver,e.semver,t);return s<0?r:s>0||e.operator==="<"&&r.operator==="<="?e:r};wu.exports=Rg});var Ou=f((t_,Nu)=>{"use strict";var Ps=qe(),Iu=ut(),Ig=P(),Lu=ys(),Lg=be(),Ng=ta(),Og=sa(),qg=oa(),xg=ca(),Mg=da(),Dg=ha(),$g=ga(),kg=va(),Pg=V(),Fg=ba(),Bg=Ta(),Ug=fr(),jg=Ca(),Wg=La(),Gg=lt(),Vg=hr(),Xg=Rs(),Kg=ws(),Hg=pr(),zg=gr(),Yg=Cs(),Qg=Pa(),Jg=dt(),Zg=X(),em=ht(),tm=Za(),rm=tu(),sm=su(),nm=ou(),im=uu(),om=Er(),am=pu(),um=mu(),cm=Su(),lm=bu(),dm=Cu();Nu.exports={parse:Lg,valid:Ng,clean:Og,inc:qg,diff:xg,major:Mg,minor:Dg,patch:$g,prerelease:kg,compare:Pg,rcompare:Fg,compareLoose:Bg,compareBuild:Ug,sort:jg,rsort:Wg,gt:Gg,lt:Vg,eq:Xg,neq:Kg,gte:Hg,lte:zg,cmp:Yg,coerce:Qg,Comparator:Jg,Range:Zg,satisfies:em,toComparators:tm,maxSatisfying:rm,minSatisfying:sm,minVersion:nm,validRange:im,outside:om,gtr:am,ltr:um,intersects:cm,simplifyRange:lm,subset:dm,SemVer:Ig,re:Ps.re,src:Ps.src,tokens:Ps.t,SEMVER_SPEC_VERSION:Iu.SEMVER_SPEC_VERSION,RELEASE_TYPES:Iu.RELEASE_TYPES,compareIdentifiers:Lu.compareIdentifiers,rcompareIdentifiers:Lu.rcompareIdentifiers}});var Bs=f((r_,Fs)=>{"use strict";var fm=Ou(),hm=ot(),xe=he(),qu=$(),xu=N(),Mu="2.7.15",pm=function(){return!1},gm=function(e){if(!fm.gte(e.VERSION,Mu))throw new Error("AWS SDK version "+Mu+" or greater required.");for(var t in e)if(e[t].serviceIdentifier){var s=e[t];s.prototype.customizeRequests(Du)}return e},mm=function(e){return e.customizeRequests(Du),e};function Du(r){var e=xe.resolveSegment(xe.resolveManualSegmentParams(r.params));if(!e){var t=this.serviceIdentifier+"."+r.operation;return xe.isAutomaticMode()?xu.getLogger().info("Call "+t+" is missing the sub/segment context for automatic mode. Ignoring."):xu.getLogger().info("Call "+t+' requires a segment object on the request params as "XRaySegment" for tracing in manual mode. Ignoring.'),r}var s=this.throttledError||pm,n=new Error().stack;let i;e.notTraced?i=e.addNewSubsegmentWithoutSampling(this.serviceIdentifier):i=e.addNewSubsegment(this.serviceIdentifier);var o=e.segment?e.segment.trace_id:e.trace_id;let a=e.segment?e.segment.additionalTraceData:e.additionalTraceData;var u=function(l){if(e.noOp)return;let d="Root="+o+";Parent="+i.id+";Sampled="+(i.notTraced?"0":"1");if(a!=null)for(let[m,h]of Object.entries(a))d+=";"+m+"="+h;l.httpRequest.headers["X-Amzn-Trace-Id"]=d},c=function(l){i.addAttribute("namespace","aws"),i.addAttribute("aws",new hm(l,i.name));var d=l.httpResponse;if(d&&(i.addAttribute("http",new $u(d)),(d.statusCode===429||l.error&&s(l.error))&&i.addThrottleFlag()),l.error){var m={message:l.error.message,name:l.error.code,stack:n};d&&d.statusCode?(qu.getCauseTypeFromHttpStatus(d.statusCode)=="error"&&i.addErrorFlag(),i.close(m,!0)):i.close(m)}else{if(d&&d.statusCode){var h=qu.getCauseTypeFromHttpStatus(d.statusCode);h&&(i[h]=!0)}i.close()}};r.on("beforePresign",function(l){e.removeSubsegment(i),e.decrementCounter(),l.removeListener("build",u),l.removeListener("complete",c)}),r.on("build",u).on("complete",c),r.__send||(r.__send=r.send,r.send=function(l){if(xe.isAutomaticMode()){var d=xe.getNamespace();d.run(function(){xe.setSegment(i),r.__send(l)})}else r.__send(l)})}function $u(r){this.init(r)}$u.prototype.init=function(e){this.response={status:e.statusCode||""},e.headers&&e.headers["content-length"]&&(this.response.content_length=e.headers["content-length"])};Fs.exports.captureAWSClient=mm;Fs.exports.captureAWS=gm});var Uu=f((s_,Bu)=>{var Sr=Object.defineProperty,vm=Object.getOwnPropertyDescriptor,Em=Object.getOwnPropertyNames,Sm=Object.prototype.hasOwnProperty,Me=(r,e)=>Sr(r,"name",{value:e,configurable:!0}),_m=(r,e)=>{for(var t in e)Sr(r,t,{get:e[t],enumerable:!0})},bm=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Em(e))!Sm.call(r,n)&&n!==t&&Sr(r,n,{get:()=>e[n],enumerable:!(s=vm(e,n))||s.enumerable});return r},ym=r=>bm(Sr({},"__esModule",{value:!0}),r),ku={};_m(ku,{isClockSkewCorrectedError:()=>Pu,isClockSkewError:()=>Lm,isRetryableByTrait:()=>Im,isServerError:()=>Om,isThrottlingError:()=>Nm,isTransientError:()=>Fu});Bu.exports=ym(ku);var Tm=["AuthFailure","InvalidSignatureException","RequestExpired","RequestInTheFuture","RequestTimeTooSkewed","SignatureDoesNotMatch"],Am=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException","TransactionInProgressException"],Rm=["TimeoutError","RequestTimeout","RequestTimeoutException"],wm=[500,502,503,504],Cm=["ECONNRESET","ECONNREFUSED","EPIPE","ETIMEDOUT"],Im=Me(r=>r.$retryable!==void 0,"isRetryableByTrait"),Lm=Me(r=>Tm.includes(r.name),"isClockSkewError"),Pu=Me(r=>{var e;return(e=r.$metadata)==null?void 0:e.clockSkewCorrected},"isClockSkewCorrectedError"),Nm=Me(r=>{var e,t;return((e=r.$metadata)==null?void 0:e.httpStatusCode)===429||Am.includes(r.name)||((t=r.$retryable)==null?void 0:t.throttling)==!0},"isThrottlingError"),Fu=Me(r=>{var e;return Pu(r)||Rm.includes(r.name)||Cm.includes(r?.code||"")||wm.includes(((e=r.$metadata)==null?void 0:e.httpStatusCode)||0)},"isTransientError"),Om=Me(r=>{var e;if(((e=r.$metadata)==null?void 0:e.httpStatusCode)!==void 0){let t=r.$metadata.httpStatusCode;return 500<=t&&t<=599&&!Fu(r)}return!1},"isServerError")});var Ku=f(De=>{"use strict";var Vu=De&&De.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(De,"__esModule",{value:!0});De.captureAWSClient=void 0;var qm=Uu(),xm=Vu(ot()),Mm=require("querystring"),Dm=Vu(rt()),Us=he(),ju=N(),{safeParseInt:_r}=$(),$m=$(),Xu="XRaySDKInstrumentation",Wu=async(r,e,t,s,n,i)=>{var o,a,u;let{extendedRequestId:c,requestId:l,httpStatusCode:d,attempts:m}=((o=n?.output)===null||o===void 0?void 0:o.$metadata)||i?.$metadata,h=new xm.default({extendedRequestId:c,requestId:l,retryCount:m,data:n?.output,request:{operation:e,params:s,httpRequest:{region:t,statusCode:d}}},r),b={};return d&&(b.response={},b.response.status=d),!((a=n?.response)===null||a===void 0)&&a.headers&&((u=n?.response)===null||u===void 0?void 0:u.headers["content-length"])!==void 0&&(b.response||(b.response={}),b.response.content_length=_r(n.response.headers["content-length"])),[h,b]};function Gu(r,e,t){var s,n,i;(t&&(0,qm.isThrottlingError)(t)||_r((s=r.response)===null||s===void 0?void 0:s.status)===429||_r((n=t?.$metadata)===null||n===void 0?void 0:n.httpStatusCode)===429)&&e.addThrottleFlag();let o=(0,$m.getCauseTypeFromHttpStatus)(_r((i=r.response)===null||i===void 0?void 0:i.status));o==="fault"?e.addFaultFlag():o==="error"&&e.addErrorFlag()}var km=(r,e)=>(t,s)=>async n=>{var i;let o=Us.isAutomaticMode()?Us.resolveSegment():e,{clientName:a,commandName:u}=s,c=(i=n?.input)!==null&&i!==void 0?i:{},l=u.slice(0,-7),d=l.charAt(0).toLowerCase()+l.slice(1),m=a.slice(0,-6);if(!o){let M=m+"."+d;return Us.isAutomaticMode()?ju.getLogger().info("Call "+M+" is missing the sub/segment context for automatic mode. Ignoring."):ju.getLogger().info("Call "+M+" requires a segment object passed to captureAWSv3Client for tracing in manual mode. Ignoring."),t(n)}let h;o.notTraced?h=o.addNewSubsegmentWithoutSampling(m):h=o.addNewSubsegment(m),h.addAttribute("namespace","aws");let b=o instanceof Dm.default?o.segment:o,C=b.segment?b.segment.additionalTraceData:b.additionalTraceData,pe=(0,Mm.stringify)({Root:b.trace_id,Parent:h.id,Sampled:h.notTraced?"0":"1"},";");if(C!=null)for(let[M,J]of Object.entries(C))pe+=";"+M+"="+J;o.noOp||(n.request.headers["X-Amzn-Trace-Id"]=pe);let Q;try{if(Q=await t(n),!Q)throw new Error("Failed to get response from instrumented AWS Client.");let[M,J]=await Wu(m,d,await r.region(),c,Q,null);return h.addAttribute("aws",M),h.addAttribute("http",J),Gu(J,h),h.close(),Q}catch(M){if(M.$metadata){let[q,K]=await Wu(m,d,await r.region(),c,null,M);h.addAttribute("aws",q),h.addAttribute("http",K),Gu(K,h,M)}let J={message:M.message,name:M.name,stack:M.stack||new Error().stack};throw h.close(J,!0),M}},Pm={name:Xu,step:"build"},Fm=(r,e)=>({applyToStack:t=>{t.add(km(r,e),Pm)}});function Bm(r,e){return r.middlewareStack.remove(Xu),r.middlewareStack.use(Fm(r.config,e)),r}De.captureAWSClient=Bm});var Ws=f((i_,js)=>{"use strict";var Hu=require("url"),$e=he(),br=$(),zu=N(),Um=require("events"),jm=function(e,t,s){e.__request||Yu(e,t,s)},Wm=function(e,t,s){if(e.__request)return e;var n={};return Object.keys(e).forEach(function(i){n[i]=e[i]}),Yu(n,t,s),n};function Yu(r,e,t){function s(o,...a){let u,c,l,d,m=a[0];if(typeof a[1]=="object"?(l=!0,d=typeof m=="string"?new Hu.URL(m):m,u=a[1],c=a[2]):(l=!1,u=m,c=a[1]),!u||u.headers&&u.headers["X-Amzn-Trace-Id"])return o(...a);typeof u=="string"&&(u=new Hu.URL(u)),l||(d=u);let h=$e.resolveSegment($e.resolveManualSegmentParams(u)),b=u.hostname||u.host||d.hostname||d.host||"Unknown host";if(!h){let q="[ host: "+b;return q=u.method?q+", method: "+u.method:q,q+=", path: "+(d.pathname||br.stripQueryStringFromPath(u.path))+" ]",$e.isAutomaticMode()?zu.getLogger().info("Options for request "+q+" is missing the sub/segment context for automatic mode. Ignoring."):zu.getLogger().info("Options for request "+q+' requires a segment object on the options params as "XRaySegment" for tracing in manual mode. Ignoring.'),o(...a)}let C;h.notTraced?C=h.addNewSubsegmentWithoutSampling(b):C=h.addNewSubsegment(b);let pe=h.segment?h.segment:h;C.namespace="remote",u.headers||(u.headers={}),h.noOp||(u.headers["X-Amzn-Trace-Id"]="Root="+pe.trace_id+";Parent="+C.id+";Sampled="+(C.notTraced?"0":"1"));let Q=function(K){if(t&&t(C,this,null,K),C.http&&C.http.response)br.getCauseTypeFromHttpStatus(C.http.response.status)==="error"&&C.addErrorFlag(),C.close(K,!0);else{let vc=K.code!=="ECONNREFUSED";C.addRemoteRequestData(this,null,vc&&e),C.close(K)}},M=br.objectWithoutProperties(u,["Segment"],!0),J=o(...l?[m,M]:[u],function(q){q.on("end",function(){t&&t(C,this.req,q),q.statusCode===429&&C.addThrottleFlag();let K=br.getCauseTypeFromHttpStatus(q.statusCode);K&&(C[K]=!0),C.addRemoteRequestData(q.req,q,!!e),C.close()}),typeof c=="function"?$e.isAutomaticMode()?$e.getNamespace().run(function(){$e.setSegment(C),c(q)}):c(q):q.req&&q.req.listenerCount("response")===0&&q.resume()});return J.on(Um.errorMonitor||"error",Q),J}r.__request=r.request;function n(...o){return s(r.__request,...o)}r.__get=r.get;function i(...o){return s(r.__get,...o)}Object.defineProperties(r,{request:{value:n,configurable:!0,enumerable:!0,writable:!0},get:{value:i,configurable:!0,enumerable:!0,writable:!0}})}js.exports.captureHTTPsGlobal=jm;js.exports.captureHTTPs=Wm});var ec=f((o_,Gs)=>{"use strict";var gt=he(),yr=Symbol("original then"),Tr=Symbol("original catch");function Ju(r){let e=r.prototype.then;e[yr]||(r.prototype.then=function(s,n){if(gt.isAutomaticMode()&&Qu()){let i=gt.getNamespace();s=s&&i.bind(s),n=n&&i.bind(n)}return e.call(this,s,n)},r.prototype.then[yr]=e);let t=r.prototype.catch;t&&!t[Tr]&&(r.prototype.catch=function(s){if(gt.isAutomaticMode()&&Qu()){let n=gt.getNamespace();s=s&&n.bind(s)}return t.call(this,s)},r.prototype.catch[Tr]=t)}function Gm(r){let e=r.prototype.then;e[yr]&&(r.prototype.then=e[yr]);let t=r.prototype.catch;t&&t[Tr]&&(r.prototype.catch=t[Tr])}function Qu(){try{return gt.getSegment()}catch{return}}function Zu(){Ju(Promise)}function Vm(){Gm(Promise)}Zu.patchThirdPartyPromise=Ju;Gs.exports.capturePromise=Zu;Gs.exports.uncapturePromise=Vm});var sc=f((a_,rc)=>{"use strict";function tc(r,e,t,s,n){this.init(r,e,t,s,n)}tc.prototype.init=function(e,t,s,n,i){e&&(this.database_version=e),t&&(this.driver_version=t),i&&(this.preparation=i),this.url=n,this.user=s};rc.exports=tc});var oc=f((u_,ic)=>{"use strict";var ae=he(),Vs=N(),ke=le(),Xm=$(),Km=So(),vt={};try{vt=_o()}catch(r){Vs.getLogger().debug("Failed to load SDK data:",r)}var mt="unknown",nc={plugins:{EC2Plugin:Io(),ECSPlugin:No(),ElasticBeanstalkPlugin:qo()},config:function(r){var e={};r.forEach(function(t){t.getData(function(s){if(s)for(var n in s)e[n]=s[n]}),ke.setOrigin(t.originName),ke.setPluginData(e)})},setAWSWhitelist:ot().setAWSWhitelist,appendAWSWhitelist:ot().appendAWSWhitelist,setStreamingThreshold:ke.setStreamingThreshold,setLogger:Vs.setLogger,getLogger:Vs.getLogger,setDaemonAddress:Wt().setDaemonAddress,captureFunc:or().captureFunc,captureAsyncFunc:or().captureAsyncFunc,captureCallbackFunc:or().captureCallbackFunc,captureAWS:Bs().captureAWS,captureAWSClient:Bs().captureAWSClient,captureAWSv3Client:Ku().captureAWSClient,captureHTTPs:Ws().captureHTTPs,captureHTTPsGlobal:Ws().captureHTTPsGlobal,capturePromise:ec().capturePromise,utils:Xm,database:{SqlData:sc()},middleware:ds(),getNamespace:ae.getNamespace,resolveSegment:ae.resolveSegment,resolveManualSegmentParams:ae.resolveManualSegmentParams,getSegment:ae.getSegment,setSegment:ae.setSegment,isAutomaticMode:ae.isAutomaticMode,enableAutomaticMode:ae.enableAutomaticMode,enableManualMode:ae.enableManualMode,setContextMissingStrategy:ae.setContextMissingStrategy,Segment:st(),Subsegment:rt(),SegmentUtils:ke};nc.middleware.IncomingRequestData=es(),function(){var r={runtime:process.release&&process.release.name?process.release.name:mt,runtime_version:process.version,version:process.env.npm_package_version||mt,name:process.env.npm_package_name||mt},e={sdk:"X-Ray for Node.js",sdk_version:vt.version?vt.version:mt,package:vt.name?vt.name:mt};ke.setSDKData(e),ke.setServiceData(r),process.env.LAMBDA_TASK_ROOT&&Km.init()}();ic.exports=nc});var Xs=f((c_,ac)=>{"use strict";ac.exports=oc()});var av={};Tc(av,{handler:()=>ov});module.exports=Ac(av);var wr=require("@aws-sdk/client-sfn");var Cr={PRETTY:4,COMPACT:0};var y={TRACE:6,DEBUG:8,INFO:12,WARN:16,ERROR:20,CRITICAL:24,SILENT:28},Ys=["level","message","sampling_rate","service","timestamp"],Qs="Uncaught error detected, flushing log buffer before exit";var Fe={REQUEST_ID:Symbol.for("_AWS_LAMBDA_REQUEST_ID"),X_RAY_TRACE_ID:Symbol.for("_AWS_LAMBDA_X_RAY_TRACE_ID"),TENANT_ID:Symbol.for("_AWS_LAMBDA_TENANT_ID")},Ir=["true","1"].includes(process.env?.AWS_LAMBDA_NODEJS_NO_GLOBAL_AWSLAMBDA??"");Ir||(globalThis.awslambda=globalThis.awslambda||{});var _t=class{static PROTECTED_KEYS=Fe;isProtectedKey(e){return Object.values(Fe).includes(e)}getRequestId(){return this.get(Fe.REQUEST_ID)??"-"}getXRayTraceId(){return this.get(Fe.X_RAY_TRACE_ID)}getTenantId(){return this.get(Fe.TENANT_ID)}},Lr=class extends _t{currentContext;getContext(){return this.currentContext}hasContext(){return this.currentContext!==void 0}get(e){return this.currentContext?.[e]}set(e,t){if(this.isProtectedKey(e))throw new Error(`Cannot modify protected Lambda context field: ${String(e)}`);this.currentContext=this.currentContext||{},this.currentContext[e]=t}run(e,t){this.currentContext=e;try{return t()}finally{this.currentContext=void 0}}},Nr=class r extends _t{als;static async create(){let e=new r,t=await import("node:async_hooks");return e.als=new t.AsyncLocalStorage,e}getContext(){return this.als.getStore()}hasContext(){return this.als.getStore()!==void 0}get(e){return this.als.getStore()?.[e]}set(e,t){if(this.isProtectedKey(e))throw new Error(`Cannot modify protected Lambda context field: ${String(e)}`);let s=this.als.getStore();if(!s)throw new Error("No context available");s[e]=t}run(e,t){return this.als.run(e,t)}},Js;(function(r){let e=null;async function t(){return e||(e=(async()=>{let n="AWS_LAMBDA_MAX_CONCURRENCY"in process.env?await Nr.create():new Lr;return!Ir&&globalThis.awslambda?.InvokeStore?globalThis.awslambda.InvokeStore:(!Ir&&globalThis.awslambda&&(globalThis.awslambda.InvokeStore=n),n)})()),e}r.getInstanceAsync=t,r._testing=process.env.AWS_LAMBDA_BENCHMARK_MODE==="1"?{reset:()=>{e=null,globalThis.awslambda?.InvokeStore&&delete globalThis.awslambda.InvokeStore,globalThis.awslambda={}}}:void 0})(Js||(Js={}));var Zs="AWS_LAMBDA_MAX_CONCURRENCY",en="POWERTOOLS_DEV",tn="POWERTOOLS_SERVICE_NAME",rn="_X_AMZN_TRACE_ID";var I=({key:r,defaultValue:e,errorMessage:t})=>{let s=process.env[r];if(s===void 0){if(e!==void 0)return e;throw t?new Error(t):new Error(`Environment variable ${r} is required`)}return s.trim()},sn=({key:r,defaultValue:e,errorMessage:t})=>{let s=I({key:r,defaultValue:String(e),errorMessage:t}),n=Number(s);if(Number.isNaN(n))throw new TypeError(`Environment variable ${r} must be a number`);return n},Rc=new Set(["1","y","yes","t","true","on"]),wc=new Set(["0","n","no","f","false","off"]),Be=({key:r,defaultValue:e,errorMessage:t,extendedParsing:s})=>{let i=I({key:r,defaultValue:String(e),errorMessage:t}).toLowerCase();if(s){if(Rc.has(i))return!0;if(wc.has(i))return!1}if(i!=="true"&&i!=="false")throw new Error(`Environment variable ${r} must be a boolean`);return i==="true"},me=()=>{try{return Be({key:en,extendedParsing:!0})}catch{return!1}},bt=()=>I({key:tn,defaultValue:""}),nn=()=>{let r=globalThis.awslambda?.InvokeStore?.getXRayTraceId()??I({key:rn,defaultValue:""});if(r==="")return;if(!r.includes("="))return{Root:r};let e={};for(let t of r.split(";")){let[s,n]=t.split("=");e[s]=n}return e},on=()=>nn()?.Sampled==="1",D=()=>I({key:Zs,defaultValue:""})!=="",Z=()=>nn()?.Root;var Ue=class{formatError(e){let{name:t,message:s,stack:n,cause:i,...o}=e,a={name:t,location:this.getCodeLocation(e.stack),message:s,stack:me()&&typeof n=="string"?n?.split(`
`):n,cause:i instanceof Error?this.formatError(i):i};for(let u in e)typeof u=="string"&&!["name","message","stack","cause"].includes(u)&&(a[u]=o[u]);return a}formatTimestamp(e){let t="UTC",s=I({key:"TZ",defaultValue:""});return s&&!s.includes(t)?this.#t(e,s):e.toISOString()}getCodeLocation(e){if(!e)return"";let t=e.split(`
`),s=/\(([^()]*?):(\d+?):(\d+?)\)\\?$/;for(let n of t){let i=s.exec(n);if(Array.isArray(i))return`${i[1]}:${Number(i[2])}`}return""}#e=e=>{let t="2-digit",s=Intl.supportedValuesOf("timeZone").includes(e)?e:"UTC";return new Intl.DateTimeFormat("en",{hourCycle:"h23",year:"numeric",month:t,day:t,hour:t,minute:t,second:t,timeZone:s})};#t(e,t){let{year:s,month:n,day:i,hour:o,minute:a,second:u}=this.#e(t).formatToParts(e).reduce((pe,Q)=>(pe[Q.type]=Q.value,pe),{}),c=`${s}-${n}-${i}T${o}:${a}:${u}`,l=-e.getTimezoneOffset(),d=l>=0?"+":"-",m=Math.abs(Math.floor(l/60)).toString().padStart(2,"0"),h=Math.abs(l%60).toString().padStart(2,"0"),b=e.getMilliseconds().toString().padStart(3,"0"),C=`${d}${m}:${h}`;return`${c}.${b}${C}`}};var Dn=ge(Ur(),1),Re=class{attributes={};constructor(e){this.setAttributes(e.attributes)}addAttributes(e){return(0,Dn.default)(this.attributes,e),this}getAttributes(){return this.attributes}prepareForPrint(){this.attributes=this.removeEmptyKeys(this.getAttributes())}removeEmptyKeys(e){let t={};for(let s in e)e[s]!==void 0&&e[s]!==""&&e[s]!==null&&(t[s]=e[s]);return t}setAttributes(e){this.attributes=e}};var Wn=require("node:console"),Gn=require("node:crypto");var ue="2.29.0";var jr=process.env.AWS_EXECUTION_ENV||"NA",Sd={relation:"after",toMiddleware:"getUserAgentMiddleware",name:"addPowertoolsToUserAgent",tags:["POWERTOOLS","USER_AGENT"]},$n=r=>typeof r=="object"&&r!==null&&"send"in r&&typeof r.send=="function"&&"config"in r&&r.config!==void 0&&typeof r.config=="object"&&r.config!==null&&"middlewareStack"in r&&r.middlewareStack!==void 0&&typeof r.middlewareStack=="object"&&r.middlewareStack!==null&&"identify"in r.middlewareStack&&typeof r.middlewareStack.identify=="function"&&"addRelativeTo"in r.middlewareStack&&typeof r.middlewareStack.addRelativeTo=="function",_d=r=>e=>async t=>{let s=t.request.headers["user-agent"]||"";if(s.includes("PT/NO-OP")){let n=s.replace("PT/NO-OP",`PT/${r}/${ue} PTEnv/${jr}`);return t.request.headers["user-agent"]=n,await e(t)}return s.includes("PT/")?await e(t):(t.request.headers["user-agent"]=s===""?`PT/${r}/${ue} PTEnv/${jr}`:`${s} PT/${r}/${ue} PTEnv/${jr}`,await e(t))},bd=r=>{let e=!1;for(let t of r){t.includes("addPowertoolsToUserAgent")&&(e=!0)}return e},Wr=(r,e)=>{try{if($n(r)){if(bd(r.middlewareStack.identify()))return;r.middlewareStack.addRelativeTo(_d(e),Sd)}else throw new Error("The client provided does not match the expected interface")}catch(t){console.warn("Failed to add user agent middleware",t)}};var Nt="powertools-for-aws",kn=`${Nt}.tracer`,Pn=`${Nt}.metrics`,Fn=`${Nt}.logger`,Bn=`${Nt}.idempotency`;var we=r=>typeof r=="string",Ot=r=>typeof r=="number",Ke=r=>Ot(r)&&Number.isInteger(r);var Un=r=>Object.is(r,null),qt=r=>Un(r)||Object.is(r,void 0),Ce=r=>!!(qt(r)||!we(r)||r.trim().length===0);var re=class{#e;coldStart=!0;defaultServiceName="service_undefined";constructor(){this.#e=this.getInitializationType(),this.#e!=="on-demand"&&(this.coldStart=!1)}getInitializationType(){let e=process.env.AWS_LAMBDA_INITIALIZATION_TYPE?.trim();return e==="on-demand"?"on-demand":e==="provisioned-concurrency"?"provisioned-concurrency":"unknown"}getColdStart(){return this.#e!=="on-demand"?!1:this.coldStart?(this.coldStart=!1,!0):!1}isValidServiceName(e){return typeof e=="string"&&e.trim().length>0}};var jn=process.env.AWS_EXECUTION_ENV||"NA";process.env.AWS_SDK_UA_APP_ID?process.env.AWS_SDK_UA_APP_ID=`${process.env.AWS_SDK_UA_APP_ID}/PT/NO-OP/${ue}/PTEnv/${jn}`:process.env.AWS_SDK_UA_APP_ID=`PT/NO-OP/${ue}/PTEnv/${jn}`;var $t=ge(Ur(),1);var xt=class extends Ue{#e;constructor(e){super(),this.#e=e?.logRecordOrder}formatAttributes(e,t){let s={level:e.logLevel,message:e.message,timestamp:this.formatTimestamp(e.timestamp),service:e.serviceName,cold_start:e.lambdaContext?.coldStart,function_arn:e.lambdaContext?.invokedFunctionArn,function_memory_size:e.lambdaContext?.memoryLimitInMB,function_name:e.lambdaContext?.functionName,function_request_id:e.lambdaContext?.awsRequestId,sampling_rate:e.sampleRateValue,xray_trace_id:e.xRayTraceId};if(this.#e===void 0)return new Re({attributes:s}).addAttributes(t);let n={};for(let o of this.#e)o in s&&!(o in n)?n[o]=s[o]:o in t&&!(o in n)&&(n[o]=t[o]);for(let o in s)o in n||(n[o]=s[o]);for(let o in t)o in n||(n[o]=t[o]);return new Re({attributes:n})}};var Mt=class{#e=Symbol("powertools.logger.temporaryAttributes");#t=Symbol("powertools.logger.keys");#n={};#i=new Map;#r={};#o(){if(!D())return this.#n;if(globalThis.awslambda?.InvokeStore===void 0)throw new Error("InvokeStore is not available");let e=globalThis.awslambda.InvokeStore,t=e.get(this.#e);return t==null&&(t={},e.set(this.#e,t)),t}#s(){if(!D())return this.#i;if(globalThis.awslambda?.InvokeStore===void 0)throw new Error("InvokeStore is not available");let e=globalThis.awslambda.InvokeStore,t=e.get(this.#t);return t==null&&(t=new Map,e.set(this.#t,t)),t}appendTemporaryKeys(e){let t=this.#o(),s=this.#s();for(let[n,i]of Object.entries(e))t[n]=i,s.set(n,"temp")}removeTemporaryKeys(e){let t=this.#o(),s=this.#s();for(let n of e)t[n]=void 0,this.#r[n]?s.set(n,"persistent"):s.delete(n)}getTemporaryAttributes(){return{...this.#o()}}clearTemporaryAttributes(){let e=this.#o(),t=this.#s();for(let s of Object.keys(e))this.#r[s]?t.set(s,"persistent"):t.delete(s);if(!D()){this.#n={};return}globalThis.awslambda.InvokeStore?.set(this.#e,{})}setPersistentAttributes(e){let t=this.#s();this.#r={...e};for(let s of Object.keys(e))t.set(s,"persistent")}getPersistentAttributes(){return{...this.#r}}getAllAttributes(){let e={},t=this.#o(),s=this.#s();for(let[n,i]of Object.entries(this.#r))i!==void 0&&(e[n]=i);for(let[n,i]of s.entries())i==="temp"&&t[n]!==void 0&&(e[n]=t[n]);return e}removePersistentKeys(e){let t=this.#s(),s=this.#o();for(let n of e)this.#r[n]=void 0,s[n]?t.set(n,"temp"):t.delete(n)}};var Gr=class{value;logLevel;byteSize;constructor(e,t){if(!we(e))throw new Error("Value should be a string");this.value=e,this.logLevel=t,this.byteSize=Buffer.byteLength(e)}},Vr=class extends Set{currentBytesSize=0;hasEvictedLog=!1;add(e){return this.currentBytesSize+=e.byteSize,super.add(e),this}delete(e){let t=super.delete(e);return t&&(this.currentBytesSize-=e.byteSize),t}clear(){super.clear(),this.currentBytesSize=0}shift(){let e=this.values().next().value;return e&&this.delete(e),e}},Dt=class extends Map{#e;#t;constructor({maxBytesSize:e,onBufferOverflow:t}){super(),this.#e=e,this.#t=t}setItem(e,t,s){let n=new Gr(t,s);if(n.byteSize>this.#e)throw new Error("Item too big");let i=this.get(e)||new Vr;return i.currentBytesSize!==0&&i.currentBytesSize+n.byteSize>=this.#e&&(this.#n(i,n),this.#t&&this.#t()),i.add(n),super.set(e,i),this}#n(e,t){for(;e.size!==0&&e.currentBytesSize+t.byteSize>=this.#e;)e.shift(),e.hasEvictedLog=!0}};var He=class r extends re{console;customConfigService;logEvent=!1;logFormatter;logIndentation=Cr.COMPACT;logLevel=y.INFO;#e;powertoolsLogData={sampleRateValue:0};#t=new Mt;#n=[];#i=!1;#r=y.INFO;#o;#s={enabled:!1,flushOnErrorLog:!0,maxBytes:20480,bufferAtVerbosity:y.DEBUG};#a;#c;#u={sampleRateValue:0,refreshedTimes:0};#f=new Map;get level(){return this.logLevel}constructor(e={}){super();let{customConfigService:t,...s}=e;this.customConfigService=t||void 0,this.setOptions(s),this.#i=!0;for(let[n,i]of this.#n)this.printLog(n,this.createAndPopulateLogItem(...i));this.#n=[]}addContext(e){this.addToPowertoolsLogData({lambdaContext:{invokedFunctionArn:e.invokedFunctionArn,coldStart:this.getColdStart(),awsRequestId:e.awsRequestId,memoryLimitInMB:e.memoryLimitInMB,functionName:e.functionName,functionVersion:e.functionVersion}})}addPersistentLogAttributes(e){this.appendPersistentKeys(e)}appendKeys(e){this.#p(e,"temp")}appendPersistentKeys(e){this.#p(e,"persistent")}createChild(e={}){let t="persistentLogAttributes"in e&&!("persistentKeys"in e)?"persistentLogAttributes":"persistentKeys",s=this.createLogger((0,$t.default)({},{logLevel:this.getLevelName(),serviceName:this.powertoolsLogData.serviceName,sampleRateValue:this.#u.sampleRateValue,logFormatter:this.getLogFormatter(),customConfigService:this.getCustomConfigService(),environment:this.powertoolsLogData.environment,[t]:this.#t.getPersistentAttributes(),jsonReplacerFn:this.#o,correlationIdSearchFn:this.#c,...this.#s.enabled&&{logBufferOptions:{maxBytes:this.#s.maxBytes,bufferAtVerbosity:this.getLogLevelNameFromNumber(this.#s.bufferAtVerbosity),flushOnErrorLog:this.#s.flushOnErrorLog}}},e));this.powertoolsLogData.lambdaContext&&s.addContext(this.powertoolsLogData.lambdaContext);let n=this.#t.getTemporaryAttributes();return Object.keys(n).length>0&&s.appendKeys(n),s}critical(e,...t){this.processLogItem(y.CRITICAL,e,t)}debug(e,...t){this.processLogItem(y.DEBUG,e,t)}error(e,...t){this.#s.enabled&&this.#s.flushOnErrorLog&&this.flushBuffer(),this.processLogItem(y.ERROR,e,t)}getLevelName(){return this.getLogLevelNameFromNumber(this.logLevel)}getLogEvent(){return this.logEvent}getPersistentLogAttributes(){return this.#t.getPersistentAttributes()}info(e,...t){this.processLogItem(y.INFO,e,t)}injectLambdaContext(e){return(t,s,n)=>{let i=n.value,o=this;n.value=async function(...a){o.refreshSampleRateCalculation(),o.addContext(a[1]),o.logEventIfEnabled(a[0],e?.logEvent),e?.correlationIdPath&&o.setCorrelationId(a[0],e?.correlationIdPath);try{return await i.apply(this,a)}catch(u){throw e?.flushBufferOnUncaughtError&&(o.flushBuffer(),o.error({message:Qs,error:u})),u}finally{(e?.clearState||e?.resetKeys)&&o.resetKeys(),o.clearBuffer()}}}}static injectLambdaContextAfterOrOnError(e,t,s){s&&(s.clearState||s?.resetKeys)&&e.resetKeys()}static injectLambdaContextBefore(e,t,s,n){e.addContext(s),e.logEventIfEnabled(t,n?.logEvent)}logEventIfEnabled(e,t){this.shouldLogEvent(t)&&this.info("Lambda invocation event",{event:e})}refreshSampleRateCalculation(){if(this.#u.refreshedTimes===0){this.#u.refreshedTimes++;return}this.#g()&&this.logLevel>y.TRACE?(this.setLogLevel("DEBUG"),this.debug("Setting log level to DEBUG due to sampling rate")):this.setLogLevel(this.getLogLevelNameFromNumber(this.#r))}removeKeys(e){this.#t.removeTemporaryKeys(e)}removePersistentKeys(e){this.#t.removePersistentKeys(e)}removePersistentLogAttributes(e){this.removePersistentKeys(e)}resetKeys(){this.#t.clearTemporaryAttributes()}setLogLevel(e){if(!this.awsLogLevelShortCircuit(e))if(this.isValidLogLevel(e))this.logLevel=y[e];else throw new Error(`Invalid log level: ${e}`)}setPersistentLogAttributes(e){let t=this.#h(e);this.#t.setPersistentAttributes(t)}get persistentLogAttributes(){return this.#t.getPersistentAttributes()}shouldLogEvent(e){return typeof e=="boolean"?e:this.getLogEvent()}trace(e,...t){this.processLogItem(y.TRACE,e,t)}warn(e,...t){this.processLogItem(y.WARN,e,t)}#l(e){this.#f.has(e)||(this.#f.set(e,!0),this.warn(e))}createLogger(e){return new r(e)}getJsonReplacer(){let e=new WeakSet;return(t,s)=>{let n=s;if(this.#o&&(n=this.#o?.(t,n)),n instanceof Error&&(n=this.getLogFormatter().formatError(n)),typeof n=="bigint")return n.toString();if(typeof n=="object"&&n!==null){if(e.has(n))return;e.add(n)}return n}}addToPowertoolsLogData(e){(0,$t.default)(this.powertoolsLogData,e)}#h(e){let t={};for(let[s,n]of Object.entries(e))this.#d(s)||(t[s]=n);return t}#p(e,t){let s=this.#h(e);if(t==="temp")this.#t.appendTemporaryKeys(s);else{let n=this.#t.getPersistentAttributes();this.#t.setPersistentAttributes((0,$t.default)(n,s))}}awsLogLevelShortCircuit(e){return this.#e!==void 0?(this.logLevel=y[this.#e],this.isValidLogLevel(e)&&this.logLevel>y[e]&&this.#l(`Current log level (${e}) does not match AWS Lambda Advanced Logging Controls minimum log level (${this.#e}). This can lead to data loss, consider adjusting them.`),!0):!1}createAndPopulateLogItem(e,t,s){let n={logLevel:this.getLogLevelNameFromNumber(e),timestamp:new Date,xRayTraceId:Z(),...this.getPowertoolsLogData(),message:""},i=this.#t.getAllAttributes();return this.#m(t,n,i),this.#v(s,i),this.getLogFormatter().formatAttributes(n,i)}#m(e,t,s){if(typeof e=="string"){t.message=e;return}let{message:n,...i}=e;t.message=n;for(let[o,a]of Object.entries(i))this.#d(o)||(s[o]=a)}#v(e,t){for(let s of e)qt(s)||(s instanceof Error?t.error=s:typeof s=="string"?t.extra=s:this.#E(s,t))}#E(e,t){for(let[s,n]of Object.entries(e))this.#d(s)||(t[s]=n)}#g(){return this.#u.sampleRateValue&&(0,Gn.randomInt)(0,100)/100<=this.#u.sampleRateValue}#d(e){return Ys.includes(e)?(this.warn(`The key "${e}" is a reserved key and will be dropped.`),!0):!1}getCustomConfigService(){return this.customConfigService}getLogFormatter(){return this.logFormatter}getLogLevelNameFromNumber(e){let t;for(let[s,n]of Object.entries(y))if(n===e){t=s;break}return t}getPowertoolsLogData(){return this.powertoolsLogData}isValidLogLevel(e){return typeof e=="string"&&e in y}isValidSampleRate(e){return typeof e=="number"&&0<=e&&e<=1}printLog(e,t){t.prepareForPrint();let s=e===y.CRITICAL?"error":this.getLogLevelNameFromNumber(e).toLowerCase();this.console[s](JSON.stringify(t.getAttributes(),this.getJsonReplacer(),this.logIndentation))}processLogItem(e,t,s){let n=Z();if(n!==void 0&&this.shouldBufferLog(n,e)){try{this.bufferLogItem(n,this.createAndPopulateLogItem(e,t,s),e)}catch(i){this.printLog(y.WARN,this.createAndPopulateLogItem(y.WARN,`Unable to buffer log: ${i.message}`,[i])),this.printLog(e,this.createAndPopulateLogItem(e,t,s))}return}e>=this.logLevel&&(this.#i?this.printLog(e,this.createAndPopulateLogItem(e,t,s)):this.#n.push([e,[e,t,s]]))}setConsole(){me()?this.console=console:this.console=new Wn.Console({stdout:process.stdout,stderr:process.stderr}),this.console.trace=(e,...t)=>{this.console.log(e,...t)}}setInitialLogLevel(e){let t=e?.toUpperCase();if(this.awsLogLevelShortCircuit(t)){this.#r=this.logLevel;return}if(this.isValidLogLevel(t)){this.logLevel=y[t],this.#r=this.logLevel;return}let s=this.getCustomConfigService()?.getLogLevel()?.toUpperCase();if(this.isValidLogLevel(s)){this.logLevel=y[s],this.#r=this.logLevel;return}let n=I({key:"POWERTOOLS_LOG_LEVEL",defaultValue:""}),i=I({key:"LOG_LEVEL",defaultValue:""}),o=n!==""?n:i;this.isValidLogLevel(o)&&(this.logLevel=y[o],this.#r=this.logLevel)}setInitialSampleRate(e){let t=e,s=this.getCustomConfigService()?.getSampleRateValue(),n=sn({key:"POWERTOOLS_LOGGER_SAMPLE_RATE",defaultValue:0});for(let i of[t,s,n])if(this.isValidSampleRate(i)){this.#u.sampleRateValue=i,this.powertoolsLogData.sampleRateValue=i,this.#g()&&this.logLevel>y.TRACE&&(this.setLogLevel("DEBUG"),this.debug("Setting log level to DEBUG due to sampling rate"));break}}setLogEvent(){this.logEvent=Be({key:"POWERTOOLS_LOGGER_LOG_EVENT",defaultValue:!1})}setLogFormatter(e,t){this.logFormatter=e??new xt({logRecordOrder:t})}setLogIndentation(){me()&&(this.logIndentation=Cr.PRETTY)}setOptions(e){let{logLevel:t,serviceName:s,sampleRateValue:n,logFormatter:i,persistentKeys:o,persistentLogAttributes:a,environment:u,jsonReplacerFn:c,logRecordOrder:l,logBufferOptions:d,correlationIdSearchFn:m}=e;a&&Object.keys(a).length>0&&o&&Object.keys(o).length>0&&this.warn("Both persistentLogAttributes and persistentKeys options were provided. Using persistentKeys as persistentLogAttributes is deprecated and will be removed in future releases"),this.setPowertoolsLogData(s,u,o||a);let h=I({key:"AWS_LAMBDA_LOG_LEVEL",defaultValue:""}),b=h==="FATAL"?"CRITICAL":h;return this.isValidLogLevel(b)&&(this.#e=b),this.setLogEvent(),this.setInitialLogLevel(t),this.setInitialSampleRate(n),this.setLogFormatter(i,l),this.setConsole(),this.setLogIndentation(),this.#o=c,this.#S(d),this.#c=m,this}setPowertoolsLogData(e,t,s){this.addToPowertoolsLogData({awsRegion:I({key:"AWS_REGION",defaultValue:""}),environment:t||this.getCustomConfigService()?.getCurrentEnvironment()||I({key:"ENVIRONMENT",defaultValue:""}),serviceName:e||this.getCustomConfigService()?.getServiceName()||I({key:"POWERTOOLS_SERVICE_NAME",defaultValue:""})||this.defaultServiceName}),s&&this.appendPersistentKeys(s)}#S(e){if(e===void 0||(this.#s.enabled=e?.enabled!==!1,this.#s.enabled===!1))return;e?.maxBytes!==void 0&&(this.#s.maxBytes=e.maxBytes),this.#a=new Dt({maxBytesSize:this.#s.maxBytes}),e?.flushOnErrorLog===!1&&(this.#s.flushOnErrorLog=!1);let t=e?.bufferAtVerbosity?.toUpperCase();this.isValidLogLevel(t)&&(this.#s.bufferAtVerbosity=y[t]),this.#e!==void 0&&y[this.#e]>this.#s.bufferAtVerbosity&&this.#l("Advanced Loggging Controls (ALC) Log Level is less verbose than Log Buffering Log Level. Buffered logs will be filtered by ALC")}bufferLogItem(e,t,s){t.prepareForPrint(),this.#a?.has(e)===!1&&this.#a?.clear(),this.#a?.setItem(e,JSON.stringify(t.getAttributes(),this.getJsonReplacer(),this.logIndentation),s)}flushBuffer(){let e=Z();if(e===void 0)return;let t=this.#a?.get(e);if(t!==void 0){for(let s of t){let n=this.getLogLevelNameFromNumber(s.logLevel).toLowerCase();this.console[n](s.value)}t.hasEvictedLog&&this.printLog(y.WARN,this.createAndPopulateLogItem(y.WARN,"Some logs are not displayed because they were evicted from the buffer. Increase buffer size to store more logs in the buffer",[])),this.#e!==void 0&&y[this.#e]>this.#s.bufferAtVerbosity&&this.#l("Advanced Loggging Controls (ALC) Log Level is less verbose than Log Buffering Log Level. Some logs might be missing."),this.#a?.delete(e)}}clearBuffer(){let e=Z();e!==void 0&&this.#a?.delete(e)}shouldBufferLog(e,t){return this.#s.enabled&&e!==void 0&&t<=this.#s.bufferAtVerbosity}setCorrelationId(e,t){if(typeof t=="string"){if(!this.#c){this.#l("correlationIdPath is set but no search function was provided. The correlation ID will not be added to the log attributes.");return}let s=this.#c(t,e);s&&this.appendKeys({correlation_id:s});return}this.appendKeys({correlation_id:e})}getCorrelationId(){return this.#t.getTemporaryAttributes().correlation_id}};var Vn="ColdStart",Xn="default_namespace";var ze={Seconds:"Seconds",Microseconds:"Microseconds",Milliseconds:"Milliseconds",Bytes:"Bytes",Kilobytes:"Kilobytes",Megabytes:"Megabytes",Gigabytes:"Gigabytes",Terabytes:"Terabytes",Bits:"Bits",Kilobits:"Kilobits",Megabits:"Megabits",Gigabits:"Gigabits",Terabits:"Terabits",Percent:"Percent",Count:"Count",BytesPerSecond:"Bytes/Second",KilobytesPerSecond:"Kilobytes/Second",MegabytesPerSecond:"Megabytes/Second",GigabytesPerSecond:"Gigabytes/Second",TerabytesPerSecond:"Terabytes/Second",BitsPerSecond:"Bits/Second",KilobitsPerSecond:"Kilobits/Second",MegabitsPerSecond:"Megabits/Second",GigabitsPerSecond:"Gigabits/Second",TerabitsPerSecond:"Terabits/Second",CountPerSecond:"Count/Second",NoUnit:"None"},ce={Standard:60,High:1};var zn=require("node:console");var kt=class{#e=Symbol("powertools.metrics.dimensions");#t=Symbol("powertools.metrics.dimensionSets");#n={};#i=[];#r={};#o(){if(!D())return this.#n;if(globalThis.awslambda?.InvokeStore===void 0)throw new Error("InvokeStore is not available");let e=globalThis.awslambda.InvokeStore,t=e.get(this.#e);return t==null&&(t={},e.set(this.#e,t)),t}#s(){if(!D())return this.#i;if(globalThis.awslambda?.InvokeStore===void 0)throw new Error("InvokeStore is not available");let e=globalThis.awslambda.InvokeStore,t=e.get(this.#t);return t==null&&(t=[],e.set(this.#t,t)),t}addDimension(e,t){return this.#o()[e]=t,t}addDimensionSet(e){return this.#s().push({...e}),e}getDimensions(){return{...this.#o()}}getDimensionSets(){return this.#s().map(e=>({...e}))}clearRequestDimensions(){if(!D()){this.#n={},this.#i=[];return}if(globalThis.awslambda?.InvokeStore===void 0)throw new Error("InvokeStore is not available");let e=globalThis.awslambda.InvokeStore;e.set(this.#e,{}),e.set(this.#t,[])}clearDefaultDimensions(){this.#r={}}getDimensionCount(){let e=this.#o(),s=this.#s().reduce((n,i)=>n+Object.keys(i).length,0);return Object.keys(e).length+Object.keys(this.#r).length+s}setDefaultDimensions(e){this.#r={...e}}getDefaultDimensions(){return{...this.#r}}};var Pt=class{#e=Symbol("powertools.metrics.metadata");#t={};#n(){if(!D())return this.#t;if(globalThis.awslambda?.InvokeStore===void 0)throw new Error("InvokeStore is not available");let e=globalThis.awslambda.InvokeStore,t=e.get(this.#e);return t==null&&(t={},e.set(this.#e,t)),t}set(e,t){return this.#n()[e]=t,t}getAll(){return{...this.#n()}}clear(){if(!D()){this.#t={};return}if(globalThis.awslambda?.InvokeStore===void 0)throw new Error("InvokeStore is not available");globalThis.awslambda.InvokeStore.set(this.#e,{})}};var Ft=class{#e=Symbol("powertools.metrics.storedMetrics");#t=Symbol("powertools.metrics.timestamp");#n={};#i;#r(){if(!D())return this.#n;if(globalThis.awslambda?.InvokeStore===void 0)throw new Error("InvokeStore is not available");let e=globalThis.awslambda.InvokeStore,t=e.get(this.#e);return t==null&&(t={},e.set(this.#e,t)),t}getMetric(e){return this.#r()[e]}setMetric(e,t,s,n=ce.Standard){let i=this.#r(),o=i[e];if(o===void 0){let a={name:e,unit:t,value:s,resolution:n};return i[e]=a,{...a}}if(o.unit!==t){let a=o.unit;throw new Error(`Metric "${e}" has already been added with unit "${a}", but we received unit "${t}". Did you mean to use metric unit "${a}"?`)}return Array.isArray(o.value)||(o.value=[o.value]),o.value.push(s),{...o,value:[...o.value]}}getMetricNames(){return Object.keys(this.#r())}getAllMetrics(){return Object.values(this.#r())}clearMetrics(){if(!D()){this.#n={},this.#i=void 0;return}if(globalThis.awslambda?.InvokeStore===void 0)throw new Error("InvokeStore is not available");let e=globalThis.awslambda.InvokeStore;e.set(this.#e,{}),e.set(this.#t,void 0)}hasMetrics(){return this.getMetricNames().length>0}getMetricsCount(){return this.getMetricNames().length}getTimestamp(){if(!D())return this.#i;if(globalThis.awslambda?.InvokeStore===void 0)throw new Error("InvokeStore is not available");return globalThis.awslambda.InvokeStore.get(this.#t)}setTimestamp(e){let t=this.#o(e);if(!D())return this.#i=t,t;if(globalThis.awslambda?.InvokeStore===void 0)throw new Error("InvokeStore is not available");return globalThis.awslambda.InvokeStore.set(this.#t,t),t}#o(e){return Ke(e)?e:e instanceof Date?e.getTime():0}};var Ye=class r extends re{console;customConfigService;#e=new kt;functionName;#t;isSingleMetric=!1;#n=new Pt;namespace;shouldThrowOnEmptyMetrics=!1;#i=new Ft;disabled=!1;#r={namespace:"",functionName:"",serviceName:"",disabled:!1,devMode:!1};constructor(e={}){super(),this.setEnvConfig(),this.setConsole(),this.#t=e.logger||this.console,this.setOptions(e)}addDimension(e,t){if(Ce(e)||Ce(t)){this.#t.warn(`The dimension ${e} doesn't meet the requirements and won't be added. Ensure the dimension name and value are non empty strings`);return}if(29<=this.#e.getDimensionCount())throw new RangeError(`The number of metric dimensions must be lower than ${29}`);let s=this.#e.getDimensions(),n=this.#e.getDefaultDimensions();(Object.hasOwn(s,e)||Object.hasOwn(n,e))&&this.#t.warn(`Dimension "${e}" has already been added. The previous value will be overwritten.`),this.#e.addDimension(e,t)}addDimensions(e){let t=this.#a(e),s=this.#e.getDimensionCount(),n=Object.keys(t).length;if(s+n>=29)throw new RangeError(`The number of metric dimensions must be lower than ${29}`);this.#e.addDimensionSet(t)}addMetadata(e,t){this.#n.set(e,t)}addMetric(e,t,s,n=ce.Standard){this.storeMetric(e,t,s,n),this.isSingleMetric&&this.publishStoredMetrics()}captureColdStartMetric(e){if(!this.getColdStart())return;let t=this.singleMetric(),s=this.functionName?.trim()??e?.trim();s&&s.length>0&&t.addDimension("function_name",s),t.addMetric(Vn,ze.Count,1)}clearDefaultDimensions(){this.#e.clearDefaultDimensions()}clearDimensions(){this.#e.clearRequestDimensions()}clearMetadata(){this.#n.clear()}clearMetrics(){this.#i.clearMetrics()}hasStoredMetrics(){return this.#i.hasMetrics()}isDisabled(){return this.disabled}logMetrics(e={}){let{throwOnEmptyMetrics:t,defaultDimensions:s,captureColdStartMetric:n}=e;return t&&this.setThrowOnEmptyMetrics(t),s!==void 0&&this.setDefaultDimensions(s),(i,o,a)=>{let u=a.value,c=this;return a.value=async function(...l){n&&c.captureColdStartMetric(l[1].functionName);let d;try{d=await u.apply(this,l)}finally{c.publishStoredMetrics()}return d},a}}publishStoredMetrics(){let e=this.hasStoredMetrics();!this.shouldThrowOnEmptyMetrics&&!e&&this.#t.warn("No application metrics to publish. The cold-start metric may be published if enabled. If application metrics should never be empty, consider using `throwOnEmptyMetrics`");if(!this.disabled){let t=this.serializeMetrics();e&&this.console.log(JSON.stringify(t))}this.clearMetrics(),this.clearDimensions(),this.clearMetadata()}setTimestamp(e){this.#s(e)||this.#t.warn("This metric doesn't meet the requirements and will be skipped by Amazon CloudWatch. Ensure the timestamp is within 14 days in the past or up to 2 hours in the future and is also a valid number or Date object."),this.#i.setTimestamp(e)}serializeMetrics(){let e=this.#i.getAllMetrics().map(u=>({Name:u.name,Unit:u.unit,...u.resolution===ce.High?{StorageResolution:u.resolution}:{}}));if(e.length===0&&this.shouldThrowOnEmptyMetrics)throw new RangeError("The number of metrics recorded must be higher than zero");this.namespace||this.#t.warn("Namespace should be defined, default used");let t=this.#i.getAllMetrics().reduce((u,{name:c,value:l})=>(u[c]=l,u),{}),s=[],n=this.#e.getDimensions(),i=this.#e.getDimensionSets(),o=this.#e.getDefaultDimensions(),a=new Set([...Object.keys(o),...Object.keys(n)]);Object.keys(n).length>0&&s.push([...a]);for(let u of i){let c=new Set([...Object.keys(o),...Object.keys(u)]);s.push([...c])}return s.length===0&&Object.keys(o).length>0&&s.push(Object.keys(o)),{_aws:{Timestamp:this.#i.getTimestamp()??Date.now(),CloudWatchMetrics:[{Namespace:this.namespace||Xn,Dimensions:s,Metrics:e}]},...o,...n,...i.reduce((u,c)=>{for(let[l,d]of Object.entries(c))u[l]=d;return u},{}),...t,...this.#n.getAll()}}setDefaultDimensions(e){let t=this.#a(e),s=this.#e.getDefaultDimensions(),n=Object.keys(s).length,i=Object.keys(t).length;if(n+i>=29)throw new RangeError(`The number of metric dimensions must be lower than ${29}`);this.#e.setDefaultDimensions({...s,...t})}setFunctionName(e){this.functionName=e}setThrowOnEmptyMetrics(e){this.shouldThrowOnEmptyMetrics=e}singleMetric(){return new r({namespace:this.namespace,defaultDimensions:this.#e.getDefaultDimensions(),singleMetric:!0,logger:this.#t})}throwOnEmptyMetrics(){this.shouldThrowOnEmptyMetrics=!0}getCustomConfigService(){return this.customConfigService}setConsole(){this.#r.devMode?this.console=console:this.console=new zn.Console({stdout:process.stdout,stderr:process.stderr})}setCustomConfigService(e){this.customConfigService=e||void 0}setEnvConfig(){this.#r.namespace=I({key:"POWERTOOLS_METRICS_NAMESPACE",defaultValue:""}),this.#r.functionName=I({key:"POWERTOOLS_METRICS_FUNCTION_NAME",defaultValue:""}),this.#r.serviceName=bt(),this.#r.disabled=Be({key:"POWERTOOLS_METRICS_DISABLED",defaultValue:!1,extendedParsing:!0}),this.#r.devMode=me()}setFunctionNameForColdStartMetric(e){let t=e?.trim()??this.#r.functionName;t&&t.length>0&&(this.functionName=t)}setNamespace(e){this.namespace=e||this.getCustomConfigService()?.getNamespace()||this.#r.namespace}setDisabled(){if("POWERTOOLS_METRICS_DISABLED"in process.env&&process.env.POWERTOOLS_METRICS_DISABLED!==void 0){this.disabled=this.#r.disabled;return}this.disabled=this.#r.devMode}setOptions(e){let{customConfigService:t,namespace:s,serviceName:n,singleMetric:i,defaultDimensions:o,functionName:a}=e;this.setCustomConfigService(t),this.setDisabled(),this.setNamespace(s);let u=this.#o(n);return this.setDefaultDimensions(o?{service:u,...o}:{service:u}),this.setFunctionNameForColdStartMetric(a),this.isSingleMetric=i||!1,this}#o(e){return e||this.getCustomConfigService()?.getServiceName()||this.#r.serviceName||this.defaultServiceName}storeMetric(e,t,s,n){if(!we(e))throw new Error(`${e} is not a valid string`);if(e.length<1||e.length>255)throw new RangeError(`The metric name should be between ${1} and ${255} characters`);if(!Ot(s))throw new RangeError(`${s} is not a valid number`);if(!Object.values(ze).includes(t))throw new RangeError(`Invalid metric unit '${t}', expected either option: ${Object.values(ze).join(",")}`);if(!Object.values(ce).includes(n))throw new RangeError(`Invalid metric resolution '${n}', expected either option: ${Object.values(ce).join(",")}`);this.#i.getMetricsCount()>=100&&this.publishStoredMetrics();let i=this.#i.setMetric(e,t,s,n);Array.isArray(i.value)&&i.value.length===100&&this.publishStoredMetrics()}#s(e){let t=e instanceof Date;if(!t&&!Ke(e))return!1;let s=t?e.getTime():e,n=Date.now(),i=n-12096e5,o=n+72e5;return s>=i&&s<=o}#a(e){let t={},s=this.#e.getDimensions();for(let[n,i]of Object.entries(e)){if(Ce(n)||Ce(i)){this.#t.warn(`The dimension ${n} doesn't meet the requirements and won't be added. Ensure the dimension name and value are non empty strings`);continue}let o=this.#e.getDefaultDimensions();(Object.hasOwn(s,n)||Object.hasOwn(o,n)||Object.hasOwn(t,n))&&this.#t.warn(`Dimension "${n}" has already been added. The previous value will be overwritten.`),t[n]=i}return t}};var mc=ge(Xs(),1);var hc=ge(Xs(),1),Ar=require("node:diagnostics_channel"),pc=ge(require("node:http"),1),gc=ge(require("node:https"),1);var Ks=require("node:url"),uc=new TextDecoder,cc=(r,e)=>{let t=-1;for(let s=0;s<r.length;s+=2)if(uc.decode(r[s]).toLowerCase()===e){t=s;break}return t===-1?null:uc.decode(r[t+1])},Hs=r=>r!==void 0&&"http"in r&&"parent"in r&&"namespace"in r&&r.namespace==="remote",lc=r=>{if(typeof r.origin=="string")return new Ks.URL(`${r.origin}${r.path||""}`);if(r.origin instanceof Ks.URL)return r.origin.pathname=r.path||"",r.origin};var{captureAWS:Hm,captureAWSClient:zm,captureAWSv3Client:Ym,captureAsyncFunc:Qm,captureFunc:Jm,captureHTTPsGlobal:dc,getNamespace:Zm,getSegment:ev,setSegment:tv,Segment:fc,setContextMissingStrategy:rv,setDaemonAddress:sv,setLogger:nv}=hc.default,Rr=class{captureAWS(e){return Hm(e)}captureAWSClient(e){return zm(e)}captureAWSv3Client(e){return Wr(e,"tracer"),Ym(e)}captureAsyncFunc(e,t,s){return Qm(e,t)}captureFunc(e,t,s){return Jm(e,t)}captureHTTPsGlobal(){dc(pc.default),dc(gc.default)}getNamespace(){return Zm()}getSegment(){return ev()}instrumentFetch(){let e=n=>{let{request:i}=n,o=i.method;if(o==="CONNECT")return;let a=this.getSegment(),u=lc(i);if(a&&u){let c=a.addNewSubsegment(u.hostname);c.addAttribute("namespace","remote"),i.addHeader("X-Amzn-Trace-Id",`Root=${Z()};Parent=${c.id};Sampled=${c.notTraced?"0":"1"}`),c.http={request:{url:`${u.protocol}//${u.hostname}${u.pathname}`,method:o}},this.setSegment(c)}},t=n=>{let{response:i}=n,o=this.getSegment();if(Hs(o)){let a=i.statusCode,u=cc(i.headers,"content-length");o.http={...o.http,response:{status:a,...u&&{content_length:Number.parseInt(u,10)}}},a===429&&o.addThrottleFlag(),a>=400&&a<500?o.addErrorFlag():a>=500&&a<600&&o.addFaultFlag(),o.close(),this.setSegment(o.parent)}},s=n=>{let{error:i}=n,o=this.getSegment();Hs(o)&&(o.addErrorFlag(),i instanceof Error&&o.addError(i,!0),o.close(),this.setSegment(o.parent))};(0,Ar.subscribe)("undici:request:create",e),(0,Ar.subscribe)("undici:request:headers",t),(0,Ar.subscribe)("undici:request:error",s)}putAnnotation(e,t){let s=this.getSegment();if(s===void 0){console.warn("No active segment or subsegment found, skipping annotation");return}if(s instanceof fc){console.warn("You cannot annotate the main segment in a Lambda execution environment");return}s.addAnnotation(e,t)}putMetadata(e,t,s){let n=this.getSegment();if(n===void 0){console.warn("No active segment or subsegment found, skipping metadata addition");return}if(n instanceof fc){console.warn("You cannot add metadata to the main segment in a Lambda execution environment");return}n.addMetadata(e,t,s)}setContextMissingStrategy(e){rv(e)}setDaemonAddress(e){sv(e)}setLogger(e){nv(e)}setSegment(e){tv(e)}};(process.env.AWS_XRAY_CONTEXT_MISSING===""||process.env.AWS_XRAY_CONTEXT_MISSING===void 0)&&(process.env.AWS_XRAY_CONTEXT_MISSING="IGNORE_ERROR");var{Subsegment:iv}=mc.default,Et=class extends re{provider;captureError=!0;captureHTTPsRequests=!0;captureResponse=!0;customConfigService;#e={awsExecutionEnv:"",samLocal:"",captureError:"",captureHTTPsRequests:"",captureResponse:"",tracingEnabled:"",serviceName:""};serviceName;tracingEnabled=!0;constructor(e={}){super(),this.#t(),this.setOptions(e),this.provider=new Rr,this.isTracingEnabled()&&this.captureHTTPsRequests&&(this.provider.captureHTTPsGlobal(),this.provider.instrumentFetch()),this.isTracingEnabled()||this.provider.setContextMissingStrategy(()=>({}))}addErrorAsMetadata(e,t){if(!this.isTracingEnabled())return;let s=this.getSegment();if(s!==void 0){if(!this.captureError){s.addErrorFlag();return}s.addError(e,t||!1)}}addResponseAsMetadata(e,t){e===void 0||!this.captureResponse||!this.isTracingEnabled()||this.putMetadata(`${t} response`,e)}addServiceNameAnnotation(){this.isTracingEnabled()&&this.putAnnotation("Service",this.serviceName)}annotateColdStart(){this.isTracingEnabled()&&this.putAnnotation("ColdStart",this.getColdStart())}captureAWS(e){return this.isTracingEnabled()?this.provider.captureAWS(e):e}captureAWSClient(e){if(!this.isTracingEnabled())return e;try{return this.provider.captureAWSClient(e)}catch(t){try{return this.provider.captureAWSClient(e.service),e}catch{throw t}}}captureAWSv3Client(e){return this.isTracingEnabled()?this.provider.captureAWSv3Client(e):e}captureLambdaHandler(e){return(t,s,n)=>{let i=n.value,o=this;return n.value=function(...a){return o.isTracingEnabled()?o.provider.captureAsyncFunc(`## ${process.env._HANDLER}`,async u=>{o.annotateColdStart(),o.addServiceNameAnnotation();let c;try{c=await i.apply(this,a),(e?.captureResponse??!0)&&o.addResponseAsMetadata(c,process.env._HANDLER)}catch(l){throw o.addErrorAsMetadata(l),l}finally{try{u?.close()}catch(l){console.warn("Failed to close or serialize segment %s. We are catching the error but data might be lost.",u?.name,l)}}return c}):i.apply(this,a)},n}}captureMethod(e){return(t,s,n)=>{let i=n.value,o=this;return n.value=function(...a){if(!o.isTracingEnabled())return i.apply(this,[...a]);let u=String(s),c=e?.subSegmentName?e.subSegmentName:`### ${u}`;return o.provider.captureAsyncFunc(c,async l=>{let d;try{d=await i.apply(this,[...a]),(e?.captureResponse??!0)&&o.addResponseAsMetadata(d,u)}catch(m){throw o.addErrorAsMetadata(m),m}finally{try{l?.close()}catch(m){console.warn("Failed to close or serialize segment %s. We are catching the error but data might be lost.",l?.name,m)}}return d})},n}}getRootXrayTraceId(){return Z()}getSegment(){if(!this.isTracingEnabled())return new iv("## Dummy segment");let e=this.provider.getSegment();return e===void 0&&console.warn("Failed to get the current sub/segment from the context, this is likely because you are not using the Tracer in a Lambda function."),e}isTraceSampled(){return this.isTracingEnabled()?on():!1}isTracingEnabled(){return this.tracingEnabled}putAnnotation(e,t){this.isTracingEnabled()&&this.provider.putAnnotation(e,t)}putMetadata(e,t,s){this.isTracingEnabled()&&this.provider.putMetadata(e,t,s||this.serviceName)}setSegment(e){this.isTracingEnabled()&&this.provider.setSegment(e)}getCustomConfigService(){return this.customConfigService}isAmplifyCli(){return this.#e.awsExecutionEnv==="AWS_Lambda_amplify-mock"}isLambdaExecutionEnv(){return this.#e.awsExecutionEnv!==""}isLambdaSamCli(){return this.#e.samLocal!==""}setCaptureError(){let e=this.getCustomConfigService()?.getTracingCaptureError();if(e!==void 0&&e.toLowerCase()==="false"){this.captureError=!1;return}if(this.#e.captureError.toLowerCase()==="false"){this.captureError=!1;return}}setCaptureHTTPsRequests(e){if(e!==void 0&&!e){this.captureHTTPsRequests=!1;return}let t=this.getCustomConfigService()?.getCaptureHTTPsRequests();if(t!==void 0&&t.toLowerCase()==="false"){this.captureHTTPsRequests=!1;return}this.#e.captureHTTPsRequests.toLowerCase()==="false"&&(this.captureHTTPsRequests=!1)}setCaptureResponse(){let e=this.getCustomConfigService()?.getTracingCaptureResponse();if(e!==void 0&&e.toLowerCase()==="false"){this.captureResponse=!1;return}if(this.#e.captureResponse.toLowerCase()==="false"){this.captureResponse=!1;return}}setCustomConfigService(e){this.customConfigService=e||void 0}setOptions(e){let{enabled:t,serviceName:s,captureHTTPsRequests:n,customConfigService:i}=e;return this.setCustomConfigService(i),this.setTracingEnabled(t),this.setCaptureResponse(),this.setCaptureError(),this.setServiceName(s),this.setCaptureHTTPsRequests(n),this}setServiceName(e){if(e!==void 0&&this.isValidServiceName(e)){this.serviceName=e;return}let t=this.getCustomConfigService()?.getServiceName();if(t!==void 0&&this.isValidServiceName(t)){this.serviceName=t;return}if(this.#e.serviceName!==void 0&&this.isValidServiceName(this.#e.serviceName)){this.serviceName=this.#e.serviceName;return}this.serviceName=this.defaultServiceName}setTracingEnabled(e){if(e!==void 0&&!e){this.tracingEnabled=e;return}let t=this.getCustomConfigService()?.getTracingEnabled();if(t!==void 0&&t.toLowerCase()==="false"){this.tracingEnabled=!1;return}if(this.#e.tracingEnabled.toLowerCase()==="false"){this.tracingEnabled=!1;return}(this.isAmplifyCli()||this.isLambdaSamCli()||!this.isLambdaExecutionEnv())&&(this.tracingEnabled=!1)}#t(){this.#e.awsExecutionEnv=I({key:"AWS_EXECUTION_ENV",defaultValue:""}),this.#e.samLocal=I({key:"AWS_SAM_LOCAL",defaultValue:""}),this.#e.captureError=I({key:"POWERTOOLS_TRACER_CAPTURE_ERROR",defaultValue:""}),this.#e.captureHTTPsRequests=I({key:"POWERTOOLS_TRACER_CAPTURE_HTTPS_REQUESTS",defaultValue:""}),this.#e.captureResponse=I({key:"POWERTOOLS_TRACER_CAPTURE_RESPONSE",defaultValue:""}),this.#e.tracingEnabled=I({key:"POWERTOOLS_TRACE_ENABLED",defaultValue:""}),this.#e.serviceName=bt()}};var Pe=new He({persistentKeys:{aws_account_id:process.env.AWS_ACCOUNT_ID||"N/A",aws_region:process.env.AWS_REGION||"N/A"}}),A_=new Ye({defaultDimensions:{aws_account_id:process.env.AWS_ACCOUNT_ID||"N/A",aws_region:process.env.AWS_REGION||"N/A"}}),R_=new Et;var ov=async(r,e)=>{Pe.info("Received event",{event:r});let t=process.env.STATE_MACHINE_ARN,s=process.env.SOURCE_BUCKET_NAME;if(!t)return Pe.error("STATE_MACHINE_ARN is not configured."),!1;let n=new wr.SFNClient({});for(let i of r.Records){let o=decodeURIComponent(i.s3.object.key.replace(/\+/g," ")),a=`s3://${s}/${i.s3.object.key}`,u=`s3://${s}`,c=JSON.stringify({mediaBucket:u,mediaFileUri:a});Pe.info(`Starting Step Functions execution for ${s}/${o}`,{input:c});try{let l=new wr.StartExecutionCommand({stateMachineArn:t,input:c});await n.send(l),Pe.info(`Successfully started execution for ${s}/${o}`)}catch(l){Pe.error("Error starting Step Functions execution",{error:l,bucketName:s,key:o})}}return!0};0&&(module.exports={handler});
/*! Bundled license information:

@aws-lambda-powertools/commons/lib/esm/awsSdkUtils.js:
  (* v8 ignore else -- @preserve *)

@aws-lambda-powertools/logger/lib/esm/logBuffer.js:
  (* v8 ignore next -- @preserve *)

@aws-lambda-powertools/metrics/lib/esm/Metrics.js:
  (* v8 ignore else -- @preserve *)

@aws-lambda-powertools/tracer/lib/esm/Tracer.js:
  (* v8 ignore else -- @preserve *)
*/
